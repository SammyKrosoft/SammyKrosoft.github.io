---
layout: post
title: Idea–Process to use to analyze performance issues using Excel (provided you captured performance data with PERFMON configured to use CSV mode–or use tools like relog or logman to convert BLG to CSV)
date: 2012-10-05 14:06
author: sammykrosoft
comments: true
categories: [Uncategorized]
---
<p>&#160;</p>  <p><strong><u><font size="3">Prerequisites :</font></u></strong></p>  <p>- Collect performance data using the updated <a href="http://blogs.technet.com/b/mikelag/archive/2009/02/02/updated-exchange-2003-perfwiz.aspx">Exchange 2003 Perfwiz</a> from Mike Lagase, or the <a href="http://experfwiz.codeplex.com/">ExPerfWiz for Exchange 2007 or 2010</a>, from Mike Lagase again</p>  <p>- Then, <strong><em>either prior to the data collection start</em></strong>, modify the destination format of Perfmon logs from BLG to CSV using Perfmon to edit the counters collection created by ExPerfWiz, <strong><em>or after the data have been collected</em></strong>, use the <a href="http://blogs.technet.com/b/askperf/archive/2008/05/20/two-minute-drill-relog-exe.aspx">RELOG tool to convert the BLG files to CSV files</a>, very easy and straightforward, like “<em><font face="Courier New">relog logfile.blg -f csv -o logfile.csv</font>” </em>(as we are going to use Excel to analyze the log files)</p>  <p>&#160;</p>  <p><u><strong><font size="3">I- Identify, colorize, isolate the counters showing any latencies on your server</font></strong></u> </p>  <p>(e.g. RPC Average Latency from MSExchangeIS Mailbox, from MSExchangeIS Client (*), as well as RPC Average<strong><u>d</u></strong> latency from MSExchangeIS …)</p>  <p>Format the cells that contain the “<strong><u>Latency</u></strong>” keyword in the headers to show in a colour (Red in my example)</p>  <p><a href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/73/61/metablogapi/6180.image_2.png" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-73-61-metablogapi/6180.image_5F00_2.png"><img style="background-image: none; border-right-width: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/73/61/metablogapi/05076.image_thumb.png" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-73-61-metablogapi/05076.image_5F00_thumb.png" width="244" height="144" /></a></p>  <p>You can copy all the “Latency” columns to an other Excel TAB, that will make the graph generation , the reading and the reporting easier.</p>  <p>To make is easier to read, also make sure you copy the first column of the performance log, which is the timeline column.</p>  <p><a href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/73/61/metablogapi/2867.image_10.png" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-73-61-metablogapi/2867.image_5F00_10.png"><img style="background-image: none; border-right-width: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/73/61/metablogapi/6175.image_thumb_4.png" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-73-61-metablogapi/6175.image_5F00_thumb_5F00_4.png" width="133" height="244" /></a></p>  <p><u><strong><font size="3">II- Identify, colorize, isolate the counters showing users statistics on your server </font></strong></u></p>  <p>(e.g. User Count, Active User Count, Connection count, Active Connection Count for MSExchangeIS and RPCClientAccess)</p>  <p>Format the cells that contain the “<strong><u>Count</u></strong>” keyword in the headers to show in an other colour (yellow in my example)</p>  <p><a href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/73/61/metablogapi/6574.image_4.png" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-73-61-metablogapi/6574.image_5F00_4.png"><img style="background-image: none; border-right-width: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/73/61/metablogapi/7242.image_thumb_1.png" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-73-61-metablogapi/7242.image_5F00_thumb_5F00_1.png" width="244" height="158" /></a></p>  <p>Again, you can copy and paste these identified columns on a separate TAB along with the time column to easier create the graph, and have a more efficient analysis.</p>  <p>&#160;</p>  <p><font size="3"><strong><u>III- Identify, colorize, isolate the counters showing the RPC operations done every second ...</u></strong></font></p>  <p>(e.g. RPC Operations/sec from MSExchangeIS Client (*), from MSExchange RPCClientAccess …)</p>  <p>Format the cells that contain the “<strong><u>RPC Operations</u></strong>” keyword in the headers to show in an other colour (brown in my example)</p>  <p><a href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/73/61/metablogapi/0880.image_6.png" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-73-61-metablogapi/0880.image_5F00_6.png"><img style="background-image: none; border-right-width: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/73/61/metablogapi/5001.image_thumb_2.png" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-73-61-metablogapi/5001.image_5F00_thumb_5F00_2.png" width="241" height="244" /></a></p>  <p>Again, you can copy and paste these identified columns on a separate TAB along with the time column to easier create the graph, and have a more efficient analysis.</p>  <p>&#160;</p>  <p><strong><font color="#000000" size="3"><u>IV – Primary analysis and next steps</u></font></strong></p>  <p><a href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/73/61/metablogapi/1106.image_8.png" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-73-61-metablogapi/1106.image_5F00_8.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/73/61/metablogapi/0513.image_thumb_3.png" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-73-61-metablogapi/0513.image_5F00_thumb_5F00_3.png" width="619" height="27" /></a></p>  <p>A first basic analysis will confirm whether or not your Exchange server is too slow, causing Outlook client experience issues (RPC dialog box, client freezing, slow Outlook opening times, …)</p>  <p>-&gt; The second step is to check the User count and the number of RPC Operations per second to see if there is no unusual activity.</p>  <p>If everything is normal regarding the number of users and the number of RPC Operations, i.e. inside the metrics you planned when you sized your server, then the issue is likely caused by an external factor such as </p>  <ul>   <li>an application causing a memory leak on the server, </li>    <li>or disks that are consuming lots of IOPS for an other application, </li>    <li>or an other application or process that is CPU intensive, </li>    <li>or also networking issues due to a poor network, a misconfigured NIC or an out-dated NIC driver or firmware, </li>    <li>or GCs overloaded preventing Exchange to answer client RPC requests in a timely manner, </li>    <li>or even an issue with the E-mail Antivirus that slows down the store processes, extending the answers to RPC requests (seen last year) </li> </ul>  <p><strong>The next step is now to see what is causing those RPC latencies, then you’ll have to check the counters like we did using steps I-, II- and III- showing:</strong></p>  <p>- LDAP Read or Search times (network or GC sizing)</p>  <p>- CPU issue (sizing)</p>  <p>- Disk latency (sizing)</p>  <p>- Memory issue (sizing or leak)</p>  <p>- Network errors (NIC configuration or hardware issue)</p>  <p>- Virus scan queue length</p>  <p>&#160;</p>  <p>For the thresholds of the above counters, check the following link :</p>  <h3><a href="http://technet.microsoft.com/en-us/library/dd335215.aspx">Performance and Scalability Counters and Thresholds</a></h3>
