---
layout: post
title: Determine the file encoding of a file - CSV file with French accents or other exotic characters that you’re trying to import in Powershell
date: 2014-03-26 10:11
author: sammykrosoft
comments: true
categories: [Uncategorized]
---
<p>Bernie and I had an issue today trying to import a CSV file using Import-CSV in Powershell V2.0, as the French accents and some dashes were not imported correctly, and then we couldn’t use some of the information in the CSV to query Exchange or AD objects with other Powershell commandlets.</p>  <p>So it appears that this depends on the encoding of the CSV file and how Powershell’s Import-CSV is handling it.</p>  <p>Using Powershell v3.0, I was able to Import-CSV the CSV file with accents and then Export filtered results in a file, keeping these special characters in Powershell and in the final filtered file, because “Import-CSV” in Powershell v3.0 has the <a href="http://technet.microsoft.com/en-us/library/hh849891.aspx">“-Encoding”</a> parameter, which is missing in Powershell v1 and v2. So in Powershell V3, I saved my CSV file using Notepad and specifying “UTF-8” encoding. Then I did an <strong>Import-CSV using the “-Encoding UTF8” parameter (remember Powershell 3.0 only)</strong>.</p>  <p><a href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/73/61/metablogapi/0211.image_2.png" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-73-61-metablogapi/0211.image_5F00_2.png"><img title="image" style="display:inline;" border="0" alt="image" src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/73/61/metablogapi/0741.image_thumb.png" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-73-61-metablogapi/0741.image_5F00_thumb.png" width="505" height="142" /></a> </p>  <p>That worked ! I kept my French accents for the names in the CSV file.</p>  <p></p>  <p>But Powershell V1 and V2 Import-CSV does not have this “-Encoding” parameter. So Bernie and I had to find in which encoding we had to save our CSV file so that the Import-CSV was keeping the initial characters, so that we can handle the objects to do some stuff with them.</p>  <p>So we tried many, and found that saving our CSV file as “Unicode” with Notepad worked fine, and saved us lot of time for the future.</p>  <p><strong>Note that by default Excel saves CSV files in the “ANSI” encoding</strong>. In my case, Powershell then imported the French accent and some other exotic characters with a “?” sign.</p>  <p>So the steps if you are using Excel to build your CSV are:</p>  <p>1- Save your Excel CSV as “.CSV” file</p>  <p>2- Open the .CSV again using NOTEPAD</p>  <p>3- Save again with NOTEPAD using the “Unicode” encoding</p>  <p><a href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/73/61/metablogapi/8512.image_4.png" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-73-61-metablogapi/8512.image_5F00_4.png"><img title="image" style="display:inline;" border="0" alt="image" src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/73/61/metablogapi/1185.image_thumb_1.png" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-73-61-metablogapi/1185.image_5F00_thumb_5F00_1.png" width="410" height="112" /></a> </p>  <p></p>  <p>… and you’re good to Import-CSV in Powershell v1 and v2, and even v3 without needing to specify the –Encoding parameter.</p>  <p></p>  <p>Below is a nice Powershell script to enable you to check which encoding is your CSV file (or any other file but I didn’t test it for other ones):</p>  <p></p>  <p><a href="http://poshcode.org/2059"><font size="4">http://poshcode.org/2059</font></a></p>  <p><font size="4">Get-FileEncoding by <strong><u>Chad Miller</u></strong> 3 years ago       <br />View followups from </font><a href="http://poshcode.org/2075"><font size="4">JasonMArcher</font></a><font size="4">, </font><a href="http://poshcode.org/3223"><font size="4">RyanFisher</font></a><font size="4">, </font><a href="http://poshcode.org/3436"><font size="4">Enter your zip code here</font></a><font size="4"> and </font><a href="http://poshcode.org/4370"><font size="4">Billy</font></a><font size="4"> | </font><a href="http://poshcode.org/2059#"><font size="4">embed code:</font></a><font size="4"> &lt;script type=&quot;text/javascript&quot; src=&quot;http://PoshCode.org/embed/2059&quot;&gt;&lt;/script&gt;</font><a href="http://poshcode.org/get/2059"><font size="4">download</font></a><font size="4"> | </font><a href="http://poshcode.org/"><font size="4">copy to clipboard</font></a><font size="4"> | </font><a href="http://poshcode.org/?new"><font size="4">new post</font></a></p>  <p></p>  <p>Pasting here for my convenience – please check for the original one and check for updates on the above original location. </p>  <div><span style="color:green;font-family:&#39;Courier New&#39;;font-size:10pt;">&lt;#     <p></p>   </span></div>  <div><span style="color:green;font-family:&#39;Courier New&#39;;font-size:10pt;">.SYNOPSIS     <p></p>   </span></div>  <div><span style="color:green;font-family:&#39;Courier New&#39;;font-size:10pt;">Gets file encoding.     <p></p>   </span></div>  <div><span style="color:green;font-family:&#39;Courier New&#39;;font-size:10pt;">.DESCRIPTION     <p></p>   </span></div>  <div><span style="color:green;font-family:&#39;Courier New&#39;;font-size:10pt;">The Get-FileEncoding function determines encoding by looking at Byte Order Mark (BOM).     <p></p>   </span></div>  <div><span style="color:green;font-family:&#39;Courier New&#39;;font-size:10pt;">Based on port of C# code from <a href="http://www.west-wind.com/Weblog/posts/197245.aspx">http://www.west-wind.com/Weblog/posts/197245.aspx</a>      <p></p>   </span></div>  <div><span style="color:green;font-family:&#39;Courier New&#39;;font-size:10pt;">.EXAMPLE     <p></p>   </span></div>  <div><span style="color:green;font-family:&#39;Courier New&#39;;font-size:10pt;">Get-ChildItem&#160; *.ps1 | select FullName, @{n=&#39;Encoding&#39;;e={Get-FileEncoding $_.FullName}} | where {$_.Encoding -ne &#39;ASCII&#39;}     <p></p>   </span></div>  <div><span style="color:green;font-family:&#39;Courier New&#39;;font-size:10pt;">This command gets ps1 files in current directory where encoding is not ASCII     <p></p>   </span></div>  <div><span style="color:green;font-family:&#39;Courier New&#39;;font-size:10pt;">.EXAMPLE     <p></p>   </span></div>  <div><span style="color:green;font-family:&#39;Courier New&#39;;font-size:10pt;">Get-ChildItem&#160; *.ps1 | select FullName, @{n=&#39;Encoding&#39;;e={Get-FileEncoding $_.FullName}} | where {$_.Encoding -ne &#39;ASCII&#39;} | foreach {(get-content $_.FullName) | set-content $_.FullName -Encoding ASCII}     <p></p>   </span></div>  <div><span style="color:green;font-family:&#39;Courier New&#39;;font-size:10pt;">Same as previous example but fixes encoding using set-content     <p></p>   </span></div>  <div><span style="color:green;font-family:&#39;Courier New&#39;;font-size:10pt;">#&gt;</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">     <p></p>   </span></div>  <div><span style="color:blue;font-family:&#39;Courier New&#39;;font-size:10pt;">function</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> </span><span style="color:cadetblue;font-family:&#39;Courier New&#39;;font-size:10pt;">Get-FileEncoding</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">     <p></p>   </span></div>  <div><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">{     <p></p>   </span></div>  <div><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">&#160;&#160;&#160; [CmdletBinding()] </span><span style="color:blue;font-family:&#39;Courier New&#39;;font-size:10pt;">Param</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> (     <p></p>   </span></div>  <div><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">&#160;&#160;&#160;&#160; [Parameter(Mandatory </span><span style="color:red;font-family:&#39;Courier New&#39;;font-size:10pt;">=</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> </span><span style="color:purple;font-family:&#39;Courier New&#39;;font-size:10pt;">$True</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">, ValueFromPipelineByPropertyName </span><span style="color:red;font-family:&#39;Courier New&#39;;font-size:10pt;">=</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> </span><span style="color:purple;font-family:&#39;Courier New&#39;;font-size:10pt;">$True</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">)] [</span><span style="color:teal;font-family:&#39;Courier New&#39;;font-size:10pt;">string</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">]</span><span style="color:purple;font-family:&#39;Courier New&#39;;font-size:10pt;">$Path</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">     <p></p>   </span></div>  <div><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">&#160;&#160;&#160; )     <p></p>   </span></div>  <div><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">     <p>&#160;</p>   </span></div>  <div><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">&#160;&#160;&#160; [</span><span style="color:teal;font-family:&#39;Courier New&#39;;font-size:10pt;">byte</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">[]]</span><span style="color:purple;font-family:&#39;Courier New&#39;;font-size:10pt;">$byte</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> </span><span style="color:red;font-family:&#39;Courier New&#39;;font-size:10pt;">=</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> </span><b><span style="color:cadetblue;font-family:&#39;Courier New&#39;;font-size:10pt;">get-content</span></b><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> </span><i><span style="color:cadetblue;font-family:&#39;Courier New&#39;;font-size:10pt;">-Encoding</span></i><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> </span><span style="color:maroon;font-family:&#39;Courier New&#39;;font-size:10pt;">byte</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> </span><i><span style="color:cadetblue;font-family:&#39;Courier New&#39;;font-size:10pt;">-ReadCount</span></i><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> 4 </span><i><span style="color:cadetblue;font-family:&#39;Courier New&#39;;font-size:10pt;">-TotalCount</span></i><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> 4 </span><i><span style="color:cadetblue;font-family:&#39;Courier New&#39;;font-size:10pt;">-Path</span></i><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> </span><span style="color:purple;font-family:&#39;Courier New&#39;;font-size:10pt;">$Path</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">     <p></p>   </span></div>  <div><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">     <p>&#160;</p>   </span></div>  <div><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">&#160;&#160;&#160; </span><span style="color:blue;font-family:&#39;Courier New&#39;;font-size:10pt;">if</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> ( </span><span style="color:purple;font-family:&#39;Courier New&#39;;font-size:10pt;">$byte</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">[0] </span><span style="color:red;font-family:&#39;Courier New&#39;;font-size:10pt;">-eq</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> 0xef </span><span style="color:red;font-family:&#39;Courier New&#39;;font-size:10pt;">-and</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> </span><span style="color:purple;font-family:&#39;Courier New&#39;;font-size:10pt;">$byte</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">[1] </span><span style="color:red;font-family:&#39;Courier New&#39;;font-size:10pt;">-eq</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> 0xbb </span><span style="color:red;font-family:&#39;Courier New&#39;;font-size:10pt;">-and</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> </span><span style="color:purple;font-family:&#39;Courier New&#39;;font-size:10pt;">$byte</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">[2] </span><span style="color:red;font-family:&#39;Courier New&#39;;font-size:10pt;">-eq</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> 0xbf )     <p></p>   </span></div>  <div><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">&#160;&#160;&#160; { </span><b><span style="color:cadetblue;font-family:&#39;Courier New&#39;;font-size:10pt;">Write-Output</span></b><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> </span><span style="color:maroon;font-family:&#39;Courier New&#39;;font-size:10pt;">&#39;UTF8&#39;</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> }     <p></p>   </span></div>  <div><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">&#160;&#160;&#160; </span><span style="color:blue;font-family:&#39;Courier New&#39;;font-size:10pt;">elseif</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> (</span><span style="color:purple;font-family:&#39;Courier New&#39;;font-size:10pt;">$byte</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">[0] </span><span style="color:red;font-family:&#39;Courier New&#39;;font-size:10pt;">-eq</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> 0xfe </span><span style="color:red;font-family:&#39;Courier New&#39;;font-size:10pt;">-and</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> </span><span style="color:purple;font-family:&#39;Courier New&#39;;font-size:10pt;">$byte</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">[1] </span><span style="color:red;font-family:&#39;Courier New&#39;;font-size:10pt;">-eq</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> 0xff)     <p></p>   </span></div>  <div><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">&#160;&#160;&#160; { </span><b><span style="color:cadetblue;font-family:&#39;Courier New&#39;;font-size:10pt;">Write-Output</span></b><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> </span><span style="color:maroon;font-family:&#39;Courier New&#39;;font-size:10pt;">&#39;Unicode&#39;</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> }     <p></p>   </span></div>  <div><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">&#160;&#160;&#160; </span><span style="color:blue;font-family:&#39;Courier New&#39;;font-size:10pt;">elseif</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> (</span><span style="color:purple;font-family:&#39;Courier New&#39;;font-size:10pt;">$byte</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">[0] </span><span style="color:red;font-family:&#39;Courier New&#39;;font-size:10pt;">-eq</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> 0 </span><span style="color:red;font-family:&#39;Courier New&#39;;font-size:10pt;">-and</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> </span><span style="color:purple;font-family:&#39;Courier New&#39;;font-size:10pt;">$byte</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">[1] </span><span style="color:red;font-family:&#39;Courier New&#39;;font-size:10pt;">-eq</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> 0 </span><span style="color:red;font-family:&#39;Courier New&#39;;font-size:10pt;">-and</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> </span><span style="color:purple;font-family:&#39;Courier New&#39;;font-size:10pt;">$byte</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">[2] </span><span style="color:red;font-family:&#39;Courier New&#39;;font-size:10pt;">-eq</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> 0xfe </span><span style="color:red;font-family:&#39;Courier New&#39;;font-size:10pt;">-and</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> </span><span style="color:purple;font-family:&#39;Courier New&#39;;font-size:10pt;">$byte</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">[3] </span><span style="color:red;font-family:&#39;Courier New&#39;;font-size:10pt;">-eq</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> 0xff)     <p></p>   </span></div>  <div><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">&#160;&#160;&#160; { </span><b><span style="color:cadetblue;font-family:&#39;Courier New&#39;;font-size:10pt;">Write-Output</span></b><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> </span><span style="color:maroon;font-family:&#39;Courier New&#39;;font-size:10pt;">&#39;UTF32&#39;</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> }     <p></p>   </span></div>  <div><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">&#160;&#160;&#160; </span><span style="color:blue;font-family:&#39;Courier New&#39;;font-size:10pt;">elseif</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> (</span><span style="color:purple;font-family:&#39;Courier New&#39;;font-size:10pt;">$byte</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">[0] </span><span style="color:red;font-family:&#39;Courier New&#39;;font-size:10pt;">-eq</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> 0x2b </span><span style="color:red;font-family:&#39;Courier New&#39;;font-size:10pt;">-and</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> </span><span style="color:purple;font-family:&#39;Courier New&#39;;font-size:10pt;">$byte</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">[1] </span><span style="color:red;font-family:&#39;Courier New&#39;;font-size:10pt;">-eq</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> 0x2f </span><span style="color:red;font-family:&#39;Courier New&#39;;font-size:10pt;">-and</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> </span><span style="color:purple;font-family:&#39;Courier New&#39;;font-size:10pt;">$byte</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">[2] </span><span style="color:red;font-family:&#39;Courier New&#39;;font-size:10pt;">-eq</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> 0x76)     <p></p>   </span></div>  <div><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">&#160;&#160;&#160; { </span><b><span style="color:cadetblue;font-family:&#39;Courier New&#39;;font-size:10pt;">Write-Output</span></b><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> </span><span style="color:maroon;font-family:&#39;Courier New&#39;;font-size:10pt;">&#39;UTF7&#39;</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">}     <p></p>   </span></div>  <div><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">&#160;&#160;&#160; </span><span style="color:blue;font-family:&#39;Courier New&#39;;font-size:10pt;">else</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">     <p></p>   </span></div>  <div><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">&#160;&#160;&#160; { </span><b><span style="color:cadetblue;font-family:&#39;Courier New&#39;;font-size:10pt;">Write-Output</span></b><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> </span><span style="color:maroon;font-family:&#39;Courier New&#39;;font-size:10pt;">&#39;ASCII&#39;</span><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;"> }     <p></p>   </span></div>  <div><span style="color:black;font-family:&#39;Courier New&#39;;font-size:10pt;">}</span><span lang="EN-CA" style="font-size:8pt;">     <p></p>   </span></div>  <div><span style="font-size:8pt;">     <p>&#160;</p>   </span></div>  <p></p>  <p></p>  <p><font size="2">&#160;</font></p>
