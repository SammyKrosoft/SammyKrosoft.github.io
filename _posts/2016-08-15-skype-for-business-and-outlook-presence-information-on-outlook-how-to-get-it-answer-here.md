---
layout: post
title: Skype for Business and Outlook - Presence information on Outlook – how to get it ? Answer is here (with “the Ugly, the Bad and the Good” illustration scenarios)
date: 2016-08-15 00:32
author: sammykrosoft
comments: true
categories: [Uncategorized]
---
<p>&nbsp;</p> <p>Hi all !</p> <p>&nbsp;</p> <p>Long time no see but I’m still around, doing some Exchange 2010, 2013, 2016 and Office 365 (mostly Exchange Online but also a bit of Skype For Business – IM and presence only for now) stuff like migrations, knowledge transfer, etc…</p> <p>So a couple of months ago I was asked the following questions:</p> <p><strong>&gt; what are the requirements, server-wise, and/or client-wise, to be able to see the Skype for Business presence light for users we add in Outlook To:, Cc: and Bcc: fields in Outlook ? </strong></p> <p><strong>&gt; same question as above, what’s needed to be able to schedule a Skype for Business meeting from Outlook ? (so that we get the Skype phone conference local and toll numbers, the conference number, the PIN, etc… in the Outlook meeting)</strong></p> <p>&nbsp;</p> <p>For the two above specific questions, the important thing to keep in mind is that these two particular features : <strong>presence light in Outlook + schedule a Skype for Business meeting</strong>, there is no interaction between the Skype for Business client and the Exchange server. Also, there is no interaction between the Outlook client and the Skype for Business (or Lync) server. Everything go through the Skype For Business add-on for Outlook !</p> <p>Yes you heard me : <strong>these two features are a client-to-client only interaction</strong>, through the Skype for Business for Outlook add-on !</p> <p>&nbsp;</p> <p>But you need a few conditions for Outlook to be able to “link” these information with Skype. <strong>You must install the Skype for Business for Outlook add-on, and the user with which you’re logged in on Outlook must have the Skype SIP address in his list of E-Mail addresses.</strong></p> <p><em>NOTE: the Outlook user’s e-mail addresses are configured on the user’s Active Directory properties, through the Exchange Management Console or the Exchange Management Shell (or the Exchange Admin Center for Exchange 2013, 2016, Exchange Online)</em></p> <p>&nbsp;</p> <p>Let’s take a user, randomly named “<strong>Sammy Krosoft</strong>”. His Exchange e-mail address is <a href="mailto:sammykrosoft@e2010domain.com"><strong>sammykrosoft@e2010domain.com</strong></a>. He’s on an On-Prem installation of Exchange 2010 (serving e2010domain.com SMTP domain). Now let’s assume he has a Skype for Business account in Office365, on a domain called “<strong>sammyservices.onmicrosoft.com</strong>” and his <strong>SIP</strong> address for Skype is <a href="mailto:&ldquo;samdrey@sammyservices.onmicrosoft.com">“<strong>samdrey@sammyservices.onmicrosoft.com</strong></a>”. We want Outlook to display the presence indicator/light of other Skype users from his Skype organization, and also to be able to get Skype meeting details when organizing a Skype meeting from that messaging application.</p> <p>&nbsp;</p> <p><strong><u><font size="3">So concretely:</font></u></strong></p> <p>1- if not already done, install the Skype for Business for Outlook add-on,</p> <p>2- the <a href="mailto:&ldquo;sammykrosoft@e2010domain.com">“<strong>sammykrosoft@e2010domain.com</strong></a>” mailbox user must have the “<strong>SIP: </strong><a href="mailto:samdrey@sammyservices.onmicrosoft.com"><strong>samdrey@sammyservices.onmicrosoft.com</strong></a>” custom address his list of E-Mail address </p> <p><em>NOTE: a “ SIP” address is not an SMTP address, there is no mail routing with this. It just serves as a “link” to enable Outlook to use the Skype for Business information (presence and meeting connection details) of a user logged in his Skype client with that SIP: address on the same workstation.</em></p> <p>3- that’s pretty much it !</p> <p>&nbsp;</p> <p>Let’s open his “E-mail addresses” properties in Exchange, and see what this <a href="mailto:&ldquo;sammykrosoft@e2010domain.com">“sammykrosoft@e2010domain.com</a>” user has:</p> <p><a href="https://msdnshared.blob.core.windows.net/media/2016/08/image377.png"><img title="image" style="border-left-width: 0px;border-right-width: 0px;border-bottom-width: 0px;padding-top: 0px;padding-left: 0px;padding-right: 0px;border-top-width: 0px" border="0" alt="image" src="https://msdnshared.blob.core.windows.net/media/2016/08/image_thumb304.png" width="456" height="546"></a></p> <p>&nbsp;</p> <p>He just has an SMTP address ! That’s not enough to enable his Outlook account to retrieve the Lync information we want ! We must add that “SIP: <a href="mailto:samdrey@sammyservices.onmicrosoft.com">samdrey@sammyservices.onmicrosoft.com</a>” entry ! Let’s do it:</p> <p>Add-&gt; Custom Address, and type the SIP addres on the “E-mail address” field, and “SIP” as the E-mail type on the below graphical input box, or if you use Powershell and the “Set-Mailbox” cmdlet, that would be literally “SIP:samdrey@sammyservices.onmicrosoft.com”. So on the GUI you have to type “SIP” and the sip address separately:</p> <p><a href="https://msdnshared.blob.core.windows.net/media/2016/08/image378.png"><img title="image" style="border-left-width: 0px;border-right-width: 0px;border-bottom-width: 0px;padding-top: 0px;padding-left: 0px;padding-right: 0px;border-top-width: 0px" border="0" alt="image" src="https://msdnshared.blob.core.windows.net/media/2016/08/image_thumb305.png" width="403" height="162"></a></p> <p>&nbsp;</p> <p>And what will we see in the E-Mail addresses window: different domains for Exchange E-mail services and for Skype for Business … we’ll see soon if it works.</p> <p><a href="https://msdnshared.blob.core.windows.net/media/2016/08/image379.png"><img title="image" style="border-left-width: 0px;border-right-width: 0px;border-bottom-width: 0px;padding-top: 0px;padding-left: 0px;padding-right: 0px;border-top-width: 0px" border="0" alt="image" src="https://msdnshared.blob.core.windows.net/media/2016/08/image_thumb306.png" width="326" height="390"></a></p> <p>&nbsp;</p> <p><strong><u><font size="3">The results</font></u></strong></p> <p>The concrete results from my Lab environment – reminder: e2010domain.com is my on-premise Exchange domain, and sammyservices.onmicrosoft.com is my Skype for Business’ tenant domain.</p> <p>- Logging in <strong>Skype for Business</strong> (O365, SIP address <a href="mailto:samdrey@sammyservices.onmicrosoft.com"><strong>samdrey@sammyservices.onmicrosoft.com</strong></a> – his Display Name is “<em>Sammy KROSOFT</em>” sorry if it doesn’t sound serious…)</p> <p><a href="https://msdnshared.blob.core.windows.net/media/2016/08/image526.png"><img title="image" style="border-left-width: 0px;border-right-width: 0px;border-bottom-width: 0px;padding-top: 0px;padding-left: 0px;padding-right: 0px;border-top-width: 0px" border="0" alt="image" src="https://msdnshared.blob.core.windows.net/media/2016/08/image_thumb418.png" width="283" height="504"></a><a href="https://msdnshared.blob.core.windows.net/media/2016/08/image527.png"><img title="image" style="border-left-width: 0px;border-right-width: 0px;border-bottom-width: 0px;padding-top: 0px;padding-left: 0px;padding-right: 0px;border-top-width: 0px" border="0" alt="image" src="https://msdnshared.blob.core.windows.net/media/2016/08/image_thumb419.png" width="359" height="325"></a></p> <p>&nbsp;</p> <p>- Then logging in Outlook (2010, 2013 or 2016, your choice, just ensure you have all latest updates for all – especially OL2010) with <a href="mailto:sammykrosoft@e2010domain.com"><strong>sammykrosoft@e2010domain.com</strong></a> on-premise account, notice the presence lights for users on the To: / Cc: fields:</p> <p><a href="https://msdnshared.blob.core.windows.net/media/2016/08/image532.png"><img title="image" style="border-left-width: 0px;border-right-width: 0px;border-bottom-width: 0px;padding-top: 0px;padding-left: 0px;padding-right: 0px;border-top-width: 0px" border="0" alt="image" src="https://msdnshared.blob.core.windows.net/media/2016/08/image_thumb424.png" width="541" height="395"></a></p> <p>… now presence light magically there when writing a new mail ….</p> <p><a href="https://msdnshared.blob.core.windows.net/media/2016/08/image533.png"><img title="image" style="border-left-width: 0px;border-right-width: 0px;border-bottom-width: 0px;padding-top: 0px;padding-left: 0px;padding-right: 0px;border-top-width: 0px" border="0" alt="image" src="https://msdnshared.blob.core.windows.net/media/2016/08/image_thumb425.png" width="479" height="508"></a></p> <p>&nbsp;</p> <p>… and we can triple-check the users’s E-mail address details from Outlook (choose the “Outlook properties” menu when right-clicking your name, choosing the drop down list icon:</p> <p><a href="https://msdnshared.blob.core.windows.net/media/2016/08/image530.png"><img title="image" style="border-left-width: 0px;border-right-width: 0px;border-bottom-width: 0px;padding-top: 0px;padding-left: 0px;padding-right: 0px;border-top-width: 0px" border="0" alt="image" src="https://msdnshared.blob.core.windows.net/media/2016/08/image_thumb422.png" width="411" height="197"></a></p> <p>&nbsp;</p> <p>You can see here the SMTP and the SIP address we added from the Exchange console earlier in this post:</p> <p><a href="https://msdnshared.blob.core.windows.net/media/2016/08/image531.png"><img title="image" style="border-left-width: 0px;border-right-width: 0px;border-bottom-width: 0px;padding-top: 0px;padding-left: 0px;padding-right: 0px;border-top-width: 0px" border="0" alt="image" src="https://msdnshared.blob.core.windows.net/media/2016/08/image_thumb423.png" width="540" height="433"></a></p> <p>&nbsp;</p> <p>And if I insert Skype meeting details, works too (note below I haven’t configured phone numbers, dial plan etc… on my Skype organization, that’s why you won’t see those, only link to Skype meeting):</p> <p><a href="https://msdnshared.blob.core.windows.net/media/2016/08/image544.png"><img title="image" style="border-left-width: 0px;border-right-width: 0px;border-bottom-width: 0px;padding-top: 0px;padding-left: 0px;padding-right: 0px;border-top-width: 0px" border="0" alt="image" src="https://msdnshared.blob.core.windows.net/media/2016/08/image_thumb436.png" width="545" height="421"></a></p> <p>&nbsp;</p> <p><strong><u><font size="3">In general</font></u></strong></p> <p>To summarize a little bit what we did above, below is some illustrations with more generic accounts, hope it will help you guys make all the above crystal clear:</p> <p><strong><font size="2">2 accounts, on 2 different services:</font></strong></p> <p><a href="https://msdnshared.blob.core.windows.net/media/2016/08/image578.png"><img title="image" style="border-top: 0px;border-right: 0px;border-bottom: 0px;padding-top: 0px;padding-left: 0px;border-left: 0px;padding-right: 0px" border="0" alt="image" src="https://msdnshared.blob.core.windows.net/media/2016/08/image_thumb466.png" width="608" height="236"></a></p> <p>&nbsp;</p> <p><strong><font size="2">First test:</font></strong></p> <p><a href="https://msdnshared.blob.core.windows.net/media/2016/08/image384.png"><img title="image" style="border-left-width: 0px;border-right-width: 0px;border-bottom-width: 0px;padding-top: 0px;padding-left: 0px;padding-right: 0px;border-top-width: 0px" border="0" alt="image" src="https://msdnshared.blob.core.windows.net/media/2016/08/image_thumb311.png" width="674" height="453"></a></p> <p><strong>=&gt; <u><font size="2">Nothing works</font></u>: </strong>we get no presence information on Outlook for other Skype users, and we get an error trying to insert Skype meetings details.</p> <p>&nbsp;</p> <p><strong><font size="2">Second test:</font></strong></p> <p><a href="https://msdnshared.blob.core.windows.net/media/2016/08/image385.png"><img title="image" style="border-left-width: 0px;border-right-width: 0px;border-bottom-width: 0px;padding-top: 0px;padding-left: 0px;padding-right: 0px;border-top-width: 0px" border="0" alt="image" src="https://msdnshared.blob.core.windows.net/media/2016/08/image_thumb312.png" width="674" height="456"></a></p> <p><strong>=&gt; <font size="2">We got presence working !</font> </strong>But we still get an error trying to insert Skype meetings details.</p> <p><strong></strong>&nbsp;</p> <p><strong>(*) Note that Skype presence info on Outlook for other users are also provided if either:</strong></p> <p>1- the SMTP e-mail we put in the recipients fields matches the SIP address of these users<br>Or</p> <p>2- the user we put in the recipients fields has a different SMTP address from the SIP address of that user, but is resolved to a user who has the SIP address in his e-mail addresses, that Skype of “user@skype-org.com” is part of the same Skype’s org.</p> <p>&nbsp;</p> <p><strong><font size="2">Last test:</font></strong></p> <p><a href="https://msdnshared.blob.core.windows.net/media/2016/08/image405.png"><img title="image" style="border-left-width: 0px;border-right-width: 0px;border-bottom-width: 0px;padding-top: 0px;padding-left: 0px;padding-right: 0px;border-top-width: 0px" border="0" alt="image" src="https://msdnshared.blob.core.windows.net/media/2016/08/image_thumb332.png" width="674" height="417"></a></p> <p><strong>=&gt; <font size="2">Both presence and Skype meeting insertion work ! Hurray !</font></strong></p> <p><strong>(*)Note:<br></strong>* like explained on the previous case, just using other words here – just to be sure everything is understood: Skype client will provide presence information to Outlook for the local user, as well as for any other users in To/Cc/Bcc for resolved users with a “SIP” address in Outlook’s “E-mail addresses” list (aka “proxyaddresses” parameter in Active Directory for users) which corresponds to a Lync user in the same organization as the locally logged on Lync user.</p> <p>&nbsp;</p> <p>&nbsp;</p> <p><strong><u>CONCLUSION:</u></strong></p> <p>The above is true whether you have Skype on O365 and Exchange On-Prem (from Exchange 2010 to Exchange 2016), or Skype on premise and Exchange On-Prem, or Skype On-Prem and Exchange Online (O365), or Exchange Online and Skype Online…</p> <p>Remember : these presence and Skype meeting details insertion features are given in Outlook by the Skype client. Outlook does NOT query the Skype server directly for either presence or meeting details. Skype 4 business client does it, and passes it on Outlook provided you have the SIP address of the Skype user on the Outlook mailbox’s user e-mail addresses.</p> <p>&nbsp;</p> <p><strong>Other features (not the point of this specific article):</strong></p> <p>There are other features that Skype for Business can use with Exchange, like storing conversation history on the Exchange mailbox, the Skype meeting tab - with meetings from the Exchange mailbox’ calendar, the contact information presence based on calendar Information, but unlike the presence information on Outlook and the meeting details insertion, these other features are achieved by the Skype client connecting to the Exchange server through <strong>Exchange Web Services URL </strong>–&gt; for that one, the Skype for Business client must “<strong>autodiscover</strong>” the Exchange Web Services URL, which it does by <strong>checking the SMTP domain suffix </strong>of the “<strong>WindowsEmailAddress</strong>” or “<strong>Mail</strong>” attribute of the AD object of the Skype user currently connected – note that this Mail or WindowsEmailAddress attribute is <strong>populated by the “Primary SMTP E-mail address” if you have Exchange On-premise</strong>. <strong>If you don’t have Exchange on-premise, you might have to populate this attribute on another way</strong> (it’s simple using Powershell script for example).</p> <p>Some information about this can be found there:</p> <p><em>Lync/Skype for Business client can't connect with Exchange in Office 365 dedicated/ITAR</em>  <p><a title="https://support.microsoft.com/en-ca/kb/3120929" href="https://support.microsoft.com/en-ca/kb/3120929">https://support.microsoft.com/en-ca/kb/3120929</a></p> <p>&nbsp;</p> <p>&nbsp;</p> <p>Cheers !</p> <p>Sam</p>
