---
layout: post
title: Exchange 2010 - Production - Public Folder replication messages stuck in the queue
date: 2014-02-12 08:49
author: sammykrosoft
comments: true
categories: [Uncategorized]
---
<p><p><u><strong>Context :</strong></u></p><p>You noticed more than 300 system messages stuck in some HUB transport servers queues with error code : <b>432 4.3.2 STOREDRV.Deliver ;Recipient thread limit exceeded</b></p><p>This is a known issue from Exchange 2010 SP1, which implements a default limitation on delivery threads, to avoid mail storms or Public Folder replication storms that could take Hub servers down (note that Public Folders are used by Outlook 2003 clients for system messages).</p><p>The solution is to slightly increase this default limitation to stay away from this issue with Public Folders replication. Below is the procedure to do this (EdgeTransport.exe.config is located on your ExchangeV14Bin folder on your servers)</p><p><b><font face="Courier new">Hub transport queue building up due to public folder replication messages.</font></b></p><p><b><u><font face="Courier new">Symptoms</font></u></b></p><p><font face="Courier new">Hub transport queue building up due to public folder replication messages.&nbsp; <br>Last Error: 432 4.3.2 STOREDRV.Deliver; recipient thread limit exceeded </font></p><p><b><u><font face="Courier new">Cause</font></u></b></p><p><font face="Courier new">Exchange 2010 SP1 implements delivery thread limits so a hand full of recipients does not cause a disruption on the hub server. Example given, Journal mailbox or public folders. </font></p><p><b><u><font face="Courier new">Resolution</font></u></b></p><p><font face="Courier new">To resolve the issue we added the following settings to edgetransport.exe.config.&nbsp; <br></font><strong><font face="Courier new">&lt;add key="RecipientThreadLimit" value="2" /&gt;        <br>&lt;add key="MaxMailboxDeliveryPerMdbConnections" value="3" /&gt;</font></strong> </p><p>The above information is explained in details in the following article as well:</p><p><a href="http://blogs.technet.com/b/exchange/archive/2011/04/11/store-driver-fault-isolation-improvements-in-exchange-2010-sp1.aspx">http://blogs.technet.com/b/exchange/archive/2011/04/11/store-driver-fault-isolation-improvements-in-exchange-2010-sp1.aspx</a></p><p>And confirming the action plan above, here is the relevant part of the article:</p><p>- There are two scenarios after applying SP1 where we are seeing customers with messages backing up in the queue. The temporary error message is:</p><p><font face="Courier New">432 4.3.2 STOREDRV.Deliver; recipient thread limit exceeded</font> </p><p>The two scenarios are:</p><p>- Journaling</p><p>- Public Folders replication</p><p>In both cases, the deliveries are occurring to a single recipient (or very small number of recipients). But it can be enough to paralyze or slow down the HUB servers.</p><p>Like every other throttling &amp; performance related feature that has ever been in Exchange, the solution isn&rsquo;t exactly straight forward. The solution is to incrementing both values up one, as follows:</p><p><strong>&lt;add key="RecipientThreadLimit" value="2" /&gt;      <br>&lt;add key="MaxMailboxDeliveryPerMdbConnections" value="3" /&gt;</strong></p><p><strong><u>=&gt; In general, Microsoft recommends to stay below 3 for RecipientThreadLimit and below 4 for MaxMAilboxDeliveryPerMdbConnections to avoid performance issues, but you may go upper depending on your hardware performance</u></strong>.</p></p>

