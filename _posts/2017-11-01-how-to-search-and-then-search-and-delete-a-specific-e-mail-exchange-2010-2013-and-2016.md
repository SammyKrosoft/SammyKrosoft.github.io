---
layout: post
title: How to search, and then delete a specific e-mail (Exchange 2010, 2013 and 2016)
date: 2017-11-01 15:02
author: sammykrosoft
comments: true
categories: [Uncategorized]
---
<h1 style="margin: 12pt 0cm 0pt;line-height: 17pt"><span lang="EN-US"><span style="font-family: calibri light"><span style="font-size: 16pt;color: #2f5496">Introduction</span></span></span></h1>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span lang="EN-US"><span style="font-size: 11pt;color: #000000">To search in Exchange (aka eDiscover), you will need to define at minimum the following:</span></span></p>
<p class="MsoListParagraphCxSpFirst" style="margin: 0cm 0cm 0pt 18pt;line-height: 12pt;text-indent: -18pt"><span style="color: #000000"><span lang="EN-US"><span><span style="font-family: wingdings"><span style="font-size: 11pt">v</span></span><span style="line-height: normal"><span style="font-family: times new roman"><span style="font-size: 7pt">  </span></span></span></span></span><span lang="EN-US"><span style="font-size: 11pt">The mailboxes you want to search in (can be a couple of mailboxes, or all mailboxes – specify nothing if you use </span></span><span style="font-size: 11pt"><span lang="EN-US"><span style="font-family: courier new">New-MailboxSearch</span></span><span lang="EN-US"> or use </span><span lang="EN-US"><span style="font-family: courier new">Get-Mailbox -ResultSize Unlimited</span></span><span lang="EN-US"> that you pipe in </span><span lang="EN-US"><span style="font-family: courier new">Search-Mailbox</span></span></span><span lang="EN-US"><span style="font-size: 11pt">)</span></span></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin: 0cm 0cm 0pt 18pt;line-height: 12pt;text-indent: -18pt"><span style="color: #000000"><span lang="EN-US"><span><span style="font-family: wingdings"><span style="font-size: 11pt">v</span></span><span style="line-height: normal"><span style="font-family: times new roman"><span style="font-size: 7pt">  </span></span></span></span></span><span lang="EN-US"><span style="font-size: 11pt">At least a search criteria, which can be </span></span></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin: 0cm 0cm 0pt 36pt;line-height: 12pt;text-indent: -18pt"><span style="color: #000000"><span lang="EN-US"><span><span style="font-size: 11pt">-</span><span style="line-height: normal"><span style="font-family: times new roman"><span style="font-size: 7pt">        </span></span></span></span></span><span lang="EN-US"><span style="font-size: 11pt">A Sender name or e-mail address</span></span></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin: 0cm 0cm 0pt 36pt;line-height: 12pt;text-indent: -18pt"><span style="color: #000000"><span lang="EN-US"><span><span style="font-size: 11pt">-</span><span style="line-height: normal"><span style="font-family: times new roman"><span style="font-size: 7pt">        </span></span></span></span></span><span lang="EN-US"><span style="font-size: 11pt">An attachment file name</span></span></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin: 0cm 0cm 0pt 36pt;line-height: 12pt;text-indent: -18pt"><span style="color: #000000"><span lang="EN-US"><span><span style="font-size: 11pt">-</span><span style="line-height: normal"><span style="font-family: times new roman"><span style="font-size: 7pt">        </span></span></span></span></span><span lang="EN-US"><span style="font-size: 11pt">A keyword in the subject only</span></span></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin: 0cm 0cm 0pt 36pt;line-height: 12pt;text-indent: -18pt"><span style="color: #000000"><span lang="EN-US"><span><span style="font-size: 11pt">-</span><span style="line-height: normal"><span style="font-family: times new roman"><span style="font-size: 7pt">        </span></span></span></span></span><span lang="EN-US"><span style="font-size: 11pt">A keyword in the whole e-mail (subject and body)</span></span></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin: 0cm 0cm 0pt 36pt;line-height: 12pt;text-indent: -18pt"><span style="color: #000000"><span lang="EN-US"><span><span style="font-size: 11pt">-</span><span style="line-height: normal"><span style="font-family: times new roman"><span style="font-size: 7pt">        </span></span></span></span></span><span lang="EN-US"><span style="font-size: 11pt">A combination of these …</span></span></span></p>
<p class="MsoListParagraphCxSpLast" style="margin: 0cm 0cm 8pt 18pt;line-height: 12pt;text-indent: -18pt"><span style="color: #000000"><span lang="EN-US"><span><span style="font-family: wingdings"><span style="font-size: 11pt">v</span></span><span style="line-height: normal"><span style="font-family: times new roman"><span style="font-size: 7pt">  </span></span></span></span></span><span lang="EN-US"><span style="font-size: 11pt">A Discovery mailbox which can be thee Discovery Mailbox or any mailboxes you have Full Access to…</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span lang="EN-US"><span style="font-size: 11pt;color: #000000"> </span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span lang="EN-US"><span style="font-size: 11pt;color: #000000">For the example in this How-To, I'll use the following :</span></span></p>
<p class="MsoListParagraphCxSpFirst" style="margin: 0cm 0cm 0pt 18pt;line-height: 12pt;text-indent: -18pt"><span style="color: #000000"><span lang="EN-US"><span><span style="font-family: wingdings"><span style="font-size: 11pt">§</span></span><span style="line-height: normal"><span style="font-family: times new roman"><span style="font-size: 7pt">  </span></span></span></span></span><span lang="EN-US"><span style="font-size: 11pt">Search in all mailboxes</span></span></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin: 0cm 0cm 0pt 18pt;line-height: 12pt;text-indent: -18pt"><span style="color: #000000"><span lang="EN-US"><span><span style="font-family: wingdings"><span style="font-size: 11pt">§</span></span><span style="line-height: normal"><span style="font-family: times new roman"><span style="font-size: 7pt">  </span></span></span></span></span><span lang="EN-US"><span style="font-size: 11pt">Sender = </span></span></span><a><span lang="EN-US"><span style="font-size: 11pt;color: #000000">Test.Canada@E2010Domain.com</span></span></a><span lang="EN-US"></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin: 0cm 0cm 0pt 18pt;line-height: 12pt;text-indent: -18pt"><span style="color: #000000"><span lang="EN-US"><span><span style="font-family: wingdings"><span style="font-size: 11pt">§</span></span><span style="line-height: normal"><span style="font-family: times new roman"><span style="font-size: 7pt">  </span></span></span></span></span><span lang="EN-US"><span style="font-size: 11pt">Start Date (optional) = 01/01/2000</span></span></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin: 0cm 0cm 0pt 18pt;line-height: 12pt;text-indent: -18pt"><span style="color: #000000"><span lang="EN-US"><span><span style="font-family: wingdings"><span style="font-size: 11pt">§</span></span><span style="line-height: normal"><span style="font-family: times new roman"><span style="font-size: 7pt">  </span></span></span></span></span><span lang="EN-US"><span style="font-size: 11pt">End Date (optional) = 01/01/2100</span></span></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin: 0cm 0cm 0pt 18pt;line-height: 12pt;text-indent: -18pt"><span style="color: #000000"><span lang="EN-US"><span><span style="font-family: wingdings"><span style="font-size: 11pt">§</span></span><span style="line-height: normal"><span style="font-family: times new roman"><span style="font-size: 7pt">  </span></span></span></span></span><span lang="EN-US"><span style="font-size: 11pt">Result mailbox (aka Discovery Mailbox or any mailboxes which you have Full Mailbox Access Rights)</span></span></span></p>
<p class="MsoListParagraphCxSpLast" style="margin: 0cm 0cm 8pt 18pt;line-height: 12pt;text-indent: -18pt"><span style="color: #000000"><span lang="EN-US"><span><span style="font-family: wingdings"><span style="font-size: 11pt">§</span></span><span style="line-height: normal"><span style="font-family: times new roman"><span style="font-size: 7pt">  </span></span></span></span></span><span lang="EN-US"><span style="font-size: 11pt">Directory to store search results in on the Result mailbox = DocStepXX-XX</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span lang="EN-US"><span style="font-size: 11pt;color: #000000"> </span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span lang="EN-US"><span style="font-size: 11pt;color: #000000">I'll go through the search, estimate and delete process in 3 steps below:</span></span></p>
<p class="MsoListParagraphCxSpFirst" style="margin: 0cm 0cm 0pt 36pt;line-height: 12pt;text-indent: -18pt"><span style="color: #000000"><span lang="EN-US"><span><span style="font-size: 11pt">-</span><span style="line-height: normal"><span style="font-family: times new roman"><span style="font-size: 7pt">        </span></span></span></span></span><span lang="EN-US"><span style="font-size: 11pt">Estimate only the searches</span></span></span></p>
<p class="MsoListParagraphCxSpMiddle" style="margin: 0cm 0cm 0pt 36pt;line-height: 12pt;text-indent: -18pt"><span style="color: #000000"><span lang="EN-US"><span><span style="font-size: 11pt">-</span><span style="line-height: normal"><span style="font-family: times new roman"><span style="font-size: 7pt">        </span></span></span></span></span><span lang="EN-US"><span style="font-size: 11pt">Search for the items and store them in a mailbox</span></span></span></p>
<p class="MsoListParagraphCxSpLast" style="margin: 0cm 0cm 8pt 36pt;line-height: 12pt;text-indent: -18pt"><span style="color: #000000"><span lang="EN-US"><span><span style="font-size: 11pt">-</span><span style="line-height: normal"><span style="font-family: times new roman"><span style="font-size: 7pt">        </span></span></span></span></span><span lang="EN-US"><span style="font-size: 11pt">Search and delete the found items</span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span lang="EN-US"><span style="font-size: 11pt;color: #000000"> </span></span></p>

<h1 style="margin: 12pt 0cm 0pt 36pt;line-height: 17pt;text-indent: -18pt"><span style="color: #2f5496"><span><span><span style="font-family: calibri light"><span style="font-size: 16pt">1.</span></span><span style="line-height: normal"><span style="font-family: times new roman"><span style="font-size: 7pt">    </span></span></span></span></span><span style="font-family: calibri light"><span style="font-size: 16pt">Estimate only searches first using New-MailboxSearch</span></span></span></h1>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span lang="EN-US"><span style="font-size: 11pt;color: #000000">Example:</span></span></p>
<p class="MsoNormal" style="background: #012456;margin: 0cm 0cm 0pt;line-height: normal"><span style="font-family: lucida console"><span><span style="color: #e0ffff"><span style="font-size: 9pt">New-MailboxSearch</span></span></span><span><span style="font-size: 9pt"><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-Name</span></span><span style="color: #000000"> </span><span><span style="color: #db7093">'DocStep01'</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-TargetMailbox</span></span><span style="color: #000000"> </span><span><span style="color: #db7093">'NCLSRestore'</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-StartDate</span></span><span style="color: #000000"> </span><span><span style="color: #db7093">'01/01/2000'</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-EndDate</span></span><span style="color: #000000"> </span><span><span style="color: #db7093">'01/01/2100'</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-SearchQuery</span></span><span style="color: #000000"> </span><span><span style="color: #db7093">"''"</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-ExcludeDuplicateMessages</span></span><span style="color: #000000"> </span><span><span style="color: #ff4500">$false</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-ErrorAction</span></span><span style="color: #000000"> </span><span><span style="color: #ee82ee">Continue</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-Senders</span></span><span style="color: #000000"> </span><span><span style="color: #db7093">"Test.Canada@E2010Domain.com"</span></span><span style="color: #000000"> </span></span><span><span style="font-size: 9pt;color: #ffe4b5">-EstimateOnly </span></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span lang="EN-US"><span style="font-size: 11pt;color: #000000"> </span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span lang="EN-US"><span style="color: #000000"><span style="font-size: 11pt">Note – The above cmdlet was generated with the help of my </span></span></span><strong><span style="font-size: 11pt"><a target="_blank" href="https://gallery.technet.microsoft.com/Exchange-eDiscovery-GUI-7a36223c" rel="noopener"><span lang="EN-US"><span style="color: #0563c1"><u>eDiscovery tool</u></span></span></a></span></strong><span lang="EN-US"><span style="font-size: 11pt;color: #000000"> </span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span><a href="https://msdnshared.blob.core.windows.net/media/2017/11/clip_image00110.png"><img title="clip_image001[10]" style="padding-top: 0px;padding-left: 0px;margin: 0px;padding-right: 0px;border-width: 0px" border="0" alt="clip_image001[10]" src="https://msdnshared.blob.core.windows.net/media/2017/11/clip_image00110_thumb.png" width="636" height="675" /></a></span><span lang="EN-US"></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span lang="EN-US"><span style="font-size: 11pt;color: #000000"> </span></span></p>

<h1 style="margin: 12pt 0cm 0pt 36pt;line-height: 17pt;text-indent: -18pt"><span style="color: #2f5496"><span><span><span style="font-family: calibri light"><span style="font-size: 16pt">2.</span></span><span style="line-height: normal"><span style="font-family: times new roman"><span style="font-size: 7pt">    </span></span></span></span></span><span style="font-family: calibri light"><span style="font-size: 16pt">Launch search using New-MailboxSearch without the "EstimateOnly" switch</span></span></span></h1>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span lang="EN-US"><span style="font-size: 11pt;color: #000000"> </span></span></p>

<h2 style="margin: 2pt 0cm 0pt 37.15pt;line-height: 14pt;text-indent: -19.15pt"><span style="color: #2f5496"><span><span><span style="font-family: calibri light"><span style="font-size: 13pt">2.1</span></span><span style="line-height: normal"><span style="font-family: times new roman"><span style="font-size: 7pt">  </span></span></span></span></span><span style="font-family: calibri light"><span style="font-size: 13pt">Launching the command</span></span></span></h2>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span lang="EN-US"><span style="font-size: 11pt;color: #000000">Once we have determined that we have our correct search criteria (Sender, keywords, etc…) and that the results found are the ones we are looking for, we will launch another search to store the results in our Search Results mailbox.</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span lang="EN-US"><span style="font-size: 11pt;color: #000000">Example:</span></span></p>
<p class="MsoNormal" style="background: #012456;margin: 0cm 0cm 0pt;line-height: normal"><span style="font-family: lucida console"><span><span style="color: #e0ffff"><span style="font-size: 9pt">New-MailboxSearch</span></span></span><span><span style="font-size: 9pt"><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-Name</span></span><span style="color: #000000"> </span><span><span style="color: #db7093">'DocStep02'</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-TargetMailbox</span></span><span style="color: #000000"> </span><span><span style="color: #db7093">'NCLSRestore'</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-StartDate</span></span><span style="color: #000000"> </span><span><span style="color: #db7093">'01/01/2000'</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-EndDate</span></span><span style="color: #000000"> </span><span><span style="color: #db7093">'01/01/2100'</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-SearchQuery</span></span><span style="color: #000000"> </span><span><span style="color: #db7093">"''"</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-ExcludeDuplicateMessages</span></span><span style="color: #000000"> </span><span><span style="color: #ff4500">$false</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-ErrorAction</span></span><span style="color: #000000"> </span><span><span style="color: #ee82ee">Continue</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-Senders</span></span><span style="color: #000000"> </span></span><span><span style="font-size: 9pt;color: #db7093">"Test.Canada@E2010Domain.com" </span></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000"> </span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000">The above was also generated with my tool, but is basically the same as the above without the -EstimateOnly switch:</span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span><a href="https://msdnshared.blob.core.windows.net/media/2017/11/clip_image00310.jpg"><img title="clip_image003[10]" style="padding-top: 0px;padding-left: 0px;margin: 0px;padding-right: 0px;border-width: 0px" border="0" alt="clip_image003[10]" src="https://msdnshared.blob.core.windows.net/media/2017/11/clip_image00310_thumb.jpg" width="862" height="915" /></a></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000"> </span></p>

<h2 style="margin: 2pt 0cm 0pt;line-height: 14pt"><span style="font-family: calibri light"><span style="font-size: 13pt;color: #2f5496">2.2 viewing the results</span></span></h2>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000">You have 2 ways to view the results : <span><span style="font-family: courier new">Get-MailboxSearch &lt;SearchName&gt;</span></span> to see just how many items found and other stats (where SearchName in my above example is "DocStep02-02"), or directly in Outlook to see the actual details as well as the findings summary.</span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000">Note: about Get-MailboxSearch &lt;SearchName&gt;, you can use my tool I mention above, on the "Retrieve MailboxSearches" tab, "Get previous mailbox search" button (the name of the "previous" search has to be on the "Folder:" field of the "Search in mailboxes" tab, and must have been used with New-MailboxSearch) :</span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span><a href="https://msdnshared.blob.core.windows.net/media/2017/11/clip_image00510.jpg"><img title="clip_image005[10]" style="padding-top: 0px;padding-left: 0px;margin: 0px;padding-right: 0px;border-width: 0px" border="0" alt="clip_image005[10]" src="https://msdnshared.blob.core.windows.net/media/2017/11/clip_image00510_thumb.jpg" width="908" height="964" /></a></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000"> </span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="color: #000000"><span style="font-size: 11pt">As stated above, the search results will be stored on the Discovery mailbox or the mailbox you chose to store the results in – in my example above it's "NCLSRestore" mailbox. I gave the searching power user the Full Mailbox Access to "NCLSRestore", so that it appears automatically on my user's mailbox thanks to </span></span><span style="font-size: 11pt"><a><span style="color: #0563c1"><u>Exchange Auto-Mapping</u></span></a><span style="color: #000000"> and Outlook's Autodiscover.</span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000">You'll see the restore mailbox on your folders' list pane, as well as the Folder that you chose to store the results in – you'll see all results will be stored in subfolders, named against each mailbox where results were found:</span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000"> </span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span><a href="https://msdnshared.blob.core.windows.net/media/2017/11/clip_image00610.png"><img title="clip_image006[10]" style="padding-top: 0px;padding-left: 0px;margin: 0px;padding-right: 0px;border-width: 0px" border="0" alt="clip_image006[10]" src="https://msdnshared.blob.core.windows.net/media/2017/11/clip_image00610_thumb.png" width="226" height="535" /></a></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000"> </span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000">You'll notice that you'll also have a mail on the root of that folder, which is a summary of your search and a few stats like what you get when you do a Get-MailboxSearch &lt;SearchName&gt;:</span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span><a href="https://msdnshared.blob.core.windows.net/media/2017/11/clip_image00710.png"><img title="clip_image007[10]" style="padding-top: 0px;padding-left: 0px;margin: 0px;padding-right: 0px;border-width: 0px" border="0" alt="clip_image007[10]" src="https://msdnshared.blob.core.windows.net/media/2017/11/clip_image00710_thumb.png" width="537" height="465" /></a></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000"> </span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000">The content is like:</span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span><a href="https://msdnshared.blob.core.windows.net/media/2017/11/clip_image00910.jpg"><img title="clip_image009[10]" style="padding-top: 0px;padding-left: 0px;margin: 0px;padding-right: 0px;border-width: 0px" border="0" alt="clip_image009[10]" src="https://msdnshared.blob.core.windows.net/media/2017/11/clip_image00910_thumb.jpg" width="1247" height="841" /></a></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000"> </span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000">And on each subfolder corresponding to the mailboxes, you can view and if needed, export the results on PSTs from Outlook to give the results to the users.</span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span><a href="https://msdnshared.blob.core.windows.net/media/2017/11/clip_image01110.jpg"><img title="clip_image011[10]" style="padding-top: 0px;padding-left: 0px;margin: 0px;padding-right: 0px;border-width: 0px" border="0" alt="clip_image011[10]" src="https://msdnshared.blob.core.windows.net/media/2017/11/clip_image01110_thumb.jpg" width="1248" height="400" /></a></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000"> </span></p>

<h1 style="margin: 12pt 0cm 0pt 36pt;line-height: 17pt;text-indent: -18pt"><span style="color: #2f5496"><span><span><span style="font-family: calibri light"><span style="font-size: 16pt">3.</span></span><span style="line-height: normal"><span style="font-family: times new roman"><span style="font-size: 7pt">    </span></span></span></span></span><span style="font-family: calibri light"><span style="font-size: 16pt">Delete the found e-mails</span></span></span></h1>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="color: #000000"><b><u><span style="font-size: 11pt">Important Note</span></u></b><span style="font-size: 11pt">: for that step, you will need the "Mailbox Import Export" management role ! </span></span><a><span style="font-size: 11pt;color: #0563c1"><u>See my article about how to grant yourself (or someone else) that role…</u></span></a></p>

<h2 style="margin: 2pt 0cm 0pt 37.15pt;line-height: 14pt;text-indent: -19.15pt"><span style="color: #2f5496"><span><span><span style="font-family: calibri light"><span style="font-size: 13pt">3.1</span></span><span style="line-height: normal"><span style="font-family: times new roman"><span style="font-size: 7pt">  </span></span></span></span></span><span style="font-family: calibri light"><span style="font-size: 13pt">Launch the Search &amp; Delete</span></span></span></h2>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000">For that step we have to use the "Search-Mailbox" cmdlet, with the -DeleteContent parameter, <b><u>using the exact same query you used on the 2 above steps</u></b>, to ensure that you delete exactly what you expect to delete and nothing else.</span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000">Example:</span></p>
<p class="MsoNormal" style="background: #012456;margin: 0cm 0cm 0pt;line-height: normal"><span style="font-family: lucida console"><span><span style="color: #e0ffff"><span style="font-size: 9pt">get-mailbox</span></span></span><span><span style="font-size: 9pt"><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-ResultSize</span></span><span style="color: #000000"> </span><span><span style="color: #ee82ee">unlimited</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-Filter</span></span><span style="color: #000000"> </span><span><span style="color: #f5f5f5">{</span></span><span><span style="color: #e0ffff">RecipientTypeDetails</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-ne</span></span><span style="color: #000000"> </span><span><span style="color: #db7093">"DiscoveryMailbox"</span></span><span><span style="color: #f5f5f5">}</span></span><span style="color: #000000"> </span><span><span style="color: #d3d3d3">|</span></span><span style="color: #000000"> </span><span><span style="color: #e0ffff">Search-Mailbox</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-TargetMailbox</span></span><span style="color: #000000"> </span><span><span style="color: #db7093">'NCLSRestore'</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-TargetFolder</span></span><span style="color: #000000"> </span><span><span style="color: #db7093">'DocStep03'</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-SearchQuery</span></span><span style="color: #000000"> </span><span><span style="color: #db7093">"'' AND from:'Test.Canada@E2010Domain.com' AND Received:01/01/2000..01/01/2100"</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-Verbose</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-DeleteContent</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-Confirm:</span></span></span><span><span style="font-size: 9pt;color: #ff4500">$false </span></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000"> </span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000">The above was also generated with my tool:</span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span><a href="https://msdnshared.blob.core.windows.net/media/2017/11/clip_image01310.jpg"><img title="clip_image013[10]" style="padding-top: 0px;padding-left: 0px;margin: 0px;padding-right: 0px;border-width: 0px" border="0" alt="clip_image013[10]" src="https://msdnshared.blob.core.windows.net/media/2017/11/clip_image01310_thumb.jpg" width="937" height="995" /></a></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000"> </span></p>

<h2 style="margin: 2pt 0cm 0pt 37.15pt;line-height: 14pt;text-indent: -19.15pt"><span style="color: #2f5496"><span><span><span style="font-family: calibri light"><span style="font-size: 13pt">3.2</span></span><span style="line-height: normal"><span style="font-family: times new roman"><span style="font-size: 7pt">  </span></span></span></span></span><span style="font-family: calibri light"><span style="font-size: 13pt">Check your items are not there anymore</span></span></span></h2>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000">We'll just use the "New-MailboxSearch" here with the -EstimateOnly switch to confirm our items are gone.</span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><i><span style="font-size: 11pt;color: #000000">NOTE: you must wait a little after items deletions as these cmdlets rely on the Exchange Database Indexes =&gt; these take a little time to update, so if you check too early, you might see the results even if these are effectively gone. Also check your Exchange Content Index health (get-mailboxdatabasecopystatus), they all must be in a "Healthy" state.</span></i></p>
<p class="MsoNormal" style="background: #012456;margin: 0cm 0cm 0pt;line-height: normal"><span style="font-family: lucida console"><span><span style="color: #e0ffff"><span style="font-size: 9pt">New-MailboxSearch</span></span></span><span><span style="font-size: 9pt"><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-Name</span></span><span style="color: #000000"> </span><span><span style="color: #db7093">'DocStep04-check01'</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-TargetMailbox</span></span><span style="color: #000000"> </span><span><span style="color: #db7093">'NCLSRestore'</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-StartDate</span></span><span style="color: #000000"> </span><span><span style="color: #db7093">'01/01/2000'</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-EndDate</span></span><span style="color: #000000"> </span><span><span style="color: #db7093">'01/01/2100'</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-SearchQuery</span></span><span style="color: #000000"> </span><span><span style="color: #db7093">"''"</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-ExcludeDuplicateMessages</span></span><span style="color: #000000"> </span><span><span style="color: #ff4500">$false</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-ErrorAction</span></span><span style="color: #000000"> </span><span><span style="color: #ee82ee">Continue</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-Senders</span></span><span style="color: #000000"> </span><span><span style="color: #db7093">"Test.Canada@E2010Domain.com"</span></span><span style="color: #000000"> </span></span><span><span style="font-size: 9pt;color: #ffe4b5">-EstimateOnly </span></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000"> </span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000">The above was also generated with my tool:</span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span><a href="https://msdnshared.blob.core.windows.net/media/2017/11/clip_image01510.jpg"><img title="clip_image015[10]" style="padding-top: 0px;padding-left: 0px;margin: 0px;padding-right: 0px;border-width: 0px" border="0" alt="clip_image015[10]" src="https://msdnshared.blob.core.windows.net/media/2017/11/clip_image01510_thumb.jpg" width="1000" height="1061" /></a></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000"> </span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000">Use Get-MailboxSearch &lt;SearchName&gt; where in the above example SearchName is the name specified on "Folder:", in my example "DocStep04-check01".</span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000">Or use my above mentioned tool, the "Retrieve Mailbox Searches" tab:</span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span><a href="https://msdnshared.blob.core.windows.net/media/2017/11/clip_image01610.png"><img title="clip_image016[10]" style="padding-top: 0px;padding-left: 0px;padding-right: 0px;border-width: 0px" border="0" alt="clip_image016[10]" src="https://msdnshared.blob.core.windows.net/media/2017/11/clip_image01610_thumb.png" width="636" height="675" /></a></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000"> </span></p>

<h2 style="margin: 2pt 0cm 0pt 37.15pt;line-height: 14pt;text-indent: -19.15pt"><span style="color: #2f5496"><span><span><span style="font-family: calibri light"><span style="font-size: 13pt">3.3</span></span><span style="line-height: normal"><span style="font-family: times new roman"><span style="font-size: 7pt">  </span></span></span></span></span><span style="font-family: calibri light"><span style="font-size: 13pt">Known issues</span></span></span></h2>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000">Sometimes, it can happen that there are too many mailboxes to Search and Delete, and PowerShell reaches some memory/buffer limit and your Search &amp; Destroy fails. If it's the case, we have to tweak a little bit the command line we used on 3.1 (that I generated using my tool).</span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000">My approach was to store all mailboxes we want to delete things from in a PowerShell variable, and then use a ForEach ($Mailbox in $AllMyMailboxes) {Search and Delete} – which takes considerably more time than if we can pipe everything (like Get-Mailbox -ResultSize unlimited) once and for all. We can mitigate that by doing a nested Foreach and store 10 mailboxes by 10 mailboxes in a temporary variable and pipe these batches to a Search-Mailbox…</span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000"> </span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000">Anyways the basic workaround will then look like this, parsing each mailbox one by one:</span></p>
<p class="MsoListParagraph" style="margin: 0cm 0cm 8pt 36pt;line-height: 12pt;text-indent: -18pt"><span style="color: #000000"><span><span><span style="font-size: 11pt">-</span><span style="line-height: normal"><span style="font-family: times new roman"><span style="font-size: 7pt">        </span></span></span></span></span><span style="font-size: 11pt">First store all mailboxes in a variable</span></span></p>
<p class="MsoNormal" style="background: #012456;margin: 0cm 0cm 0pt;line-height: normal"><span style="font-family: lucida console"><span><span style="color: #ff4500"><span style="font-size: 9pt">AllMyMailboxes</span></span></span><span><span style="font-size: 9pt"><span style="color: #000000"> </span><span><span style="color: #d3d3d3">=</span></span><span style="color: #000000"> </span><span><span style="color: #e0ffff">get-mailbox</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-ResultSize</span></span><span style="color: #000000"> </span><span><span style="color: #ee82ee">unlimited</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-Filter</span></span><span style="color: #000000"> </span><span><span style="color: #f5f5f5">{</span></span><span><span style="color: #e0ffff">RecipientTypeDetails</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-ne</span></span><span style="color: #000000"> </span><span><span style="color: #db7093">"DiscoveryMailbox"</span></span></span><span><span style="font-size: 9pt;color: #f5f5f5">} </span></span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000"> </span></p>
<p class="MsoListParagraph" style="margin: 0cm 0cm 8pt 36pt;line-height: 12pt;text-indent: -18pt"><span style="color: #000000"><span><span><span style="font-size: 11pt">-</span><span style="line-height: normal"><span style="font-family: times new roman"><span style="font-size: 7pt">        </span></span></span></span></span><span style="font-size: 11pt">Second with your Foreach loop, parse each mailbox and launch a Search an Delete – NOTE: you must use the -Force parameter with Search-Mailbox to avoid being prompted "Are you sure [Y]/[A]/[N] for each mailbox…)</span></span></p>
<p class="MsoNormal" style="background: #012456;margin: 0cm 0cm 0pt 18pt;line-height: normal"><span style="font-family: lucida console"><span><span style="color: #e0ffff"><span style="font-size: 9pt">ForEach</span></span></span><span><span style="font-size: 9pt"><span style="color: #000000"> </span><span><span style="color: #f5f5f5">(</span></span><span><span style="color: #ff4500">$Mailbox</span></span><span style="color: #000000"> </span><span><span style="color: #e0ffff">in</span></span><span style="color: #000000"> </span><span><span style="color: #ff4500">$MyMailboxes</span></span><span><span style="color: #f5f5f5">)</span></span><span style="color: #000000"> </span></span><span><span style="font-size: 9pt;color: #f5f5f5">{</span></span></span></span></p>
<p class="MsoNormal" style="background: #012456;margin: 0cm 0cm 0pt 18pt;line-height: normal"><span><span style="font-family: lucida console"><span><span style="color: #000000"><span style="font-size: 9pt">    </span></span></span><span style="font-size: 9pt"><span><span style="color: #e0ffff">Search-Mailbox</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-SourceMailbox</span></span><span style="color: #000000"> </span><span><span style="color: #ff4500">$Mailbox</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-TargetMailbox</span></span><span style="color: #000000"> </span><span><span style="color: #db7093">'NCLSRestore'</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-TargetFolder</span></span><span style="color: #000000"> </span><span><span style="color: #db7093">'DocStep03'</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-SearchQuery</span></span><span style="color: #000000"> </span><span><span style="color: #db7093">"'' AND from:'Test.Canada@E2010Domain.com' AND Received:01/01/2000..01/01/2100"</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-Verbose</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-DeleteContent</span></span><span style="color: #000000"> </span><span><span style="color: #ffe4b5">-Confirm:</span></span><span><span style="color: #ff4500">$false</span></span><span style="color: #000000"> </span></span><span><span style="font-size: 9pt;color: #ffe4b5">-Force</span></span></span><span></span></span></p>
<p class="MsoNormal" style="background: #012456;margin: 0cm 0cm 0pt 18pt;line-height: normal"><span><span style="font-family: lucida console"><span style="font-size: 9pt;color: #f5f5f5">} </span></span></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 8pt;line-height: 12pt"><span style="font-size: 11pt;color: #000000"> </span></p>
