---
layout: post
title: How-to use Powershell to change the Network location type (to Private or Public)
date: 2011-10-19 13:04
author: sammykrosoft
comments: true
categories: [Uncategorized]
---
<p>&nbsp;<p>Here is how to change the Network type of a specific network (or networks) to Private or Public, to help you better master Firewall policies.</p><p>This is especially useful if you have a bunch of Windows 2008 servers on a DMZ as it&rsquo;s more and more the case, which are not controlled by GPOs then.</p><p>Credits goes to Vladimir Averkin&rsquo;s great <a href="http://blogs.msdn.com/b/powershell/archive/2009/04/03/setting-network-location-to-private.aspx" target="_blank">Powershell post</a>, that I slightly modified to&nbsp; be a little bit more precise regarding the settings. I added the $PrivateNetwork and $PublicNetwork variables to better understand the use of the SetCategory() .Net method.</p><p>&nbsp;</p><p>&nbsp;</p><div class="WordSection1">   <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: green; font-size: 9pt'>#Static variables definition (never change them)<p></p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: purple; font-size: 9pt'>$<span class="SpellE">PrivateNetwork</span></span><span style='font-family: "Courier New"; color: red; font-size: 9pt'>=</span><span style='font-family: "Courier New"; color: black; font-size: 9pt'>1<p></p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: purple; font-size: 9pt'>$<span class="SpellE">PublicNetwork</span></span><span style='font-family: "Courier New"; color: red; font-size: 9pt'>=</span><span style='font-family: "Courier New"; color: black; font-size: 9pt'>3<p></p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: black; font-size: 9pt'>&nbsp;</span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: green; font-size: 9pt'>#####################################<p></p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: green; font-size: 9pt'>##### CHANGES TO CUSTOMIZE ":&nbsp;&nbsp; ##### <p></p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: green; font-size: 9pt'>##### - Network name(s)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ##### <p></p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: green; font-size: 9pt'>##### - Set to Private or Public##### <p></p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: green; font-size: 9pt'>#####################################<p></p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: green; font-size: 9pt'>#Change the network name on the line below to the network name you want to change:<p></p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: purple; font-size: 9pt'>$NetworkNameFilter1</span><span style='font-family: "Courier New"; color: black; font-size: 9pt'> </span><span style='font-family: "Courier New"; color: red; font-size: 9pt'>=</span><span style='font-family: "Courier New"; color: black; font-size: 9pt'> </span><span style='font-family: "Courier New"; color: maroon; font-size: 9pt'>"Partial name with wildcard or full network name"</span><span style='font-family: "Courier New"; color: black; font-size: 9pt'><p></p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: green; font-size: 9pt'>#Change the type you want to assign to the above named <span class="GramE">network :</span><p></p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: purple; font-size: 9pt'>$<span class="SpellE">NetworkTypeAssignment</span></span><span style='font-family: "Courier New"; color: black; font-size: 9pt'> </span><span style='font-family: "Courier New"; color: red; font-size: 9pt'>=</span><span style='font-family: "Courier New"; color: black; font-size: 9pt'> </span><span style='font-family: "Courier New"; color: purple; font-size: 9pt'>$<span class="SpellE">PrivateNetwork</span></span><span style='font-family: "Courier New"; color: black; font-size: 9pt'><p></p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: green; font-size: 9pt'>#######################################<p></p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: green; font-size: 9pt'>##### End of changes customization##### <p></p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: green; font-size: 9pt'>#######################################<p></p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: black; font-size: 9pt'><p>&nbsp;</p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: black; font-size: 9pt'><p>&nbsp;</p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: green; font-size: 9pt'># Better for error control - Script is working from Vista to upper OS versions, including server OS <p></p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: green; font-size: 9pt'># =&gt; skip network location setting for pre-Vista operating systems<p></p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span class="GramE"><span style='font-family: "Courier New"; color: blue; font-size: 9pt'>if</span><span style='font-family: "Courier New"; color: black; font-size: 9pt'>(</span></span><span style='font-family: "Courier New"; color: black; font-size: 9pt'>[</span><span style='font-family: "Courier New"; color: teal; font-size: 9pt'>environment</span><span style='font-family: "Courier New"; color: black; font-size: 9pt'>]::</span><span class="SpellE"><span style='font-family: "Courier New"; color: saddlebrown; font-size: 9pt'>OSVersion</span><span style='font-family: "Courier New"; color: black; font-size: 9pt'>.</span><span style='font-family: "Courier New"; color: saddlebrown; font-size: 9pt'>version</span><span style='font-family: "Courier New"; color: black; font-size: 9pt'>.</span><span style='font-family: "Courier New"; color: saddlebrown; font-size: 9pt'>Major</span></span><span style='font-family: "Courier New"; color: black; font-size: 9pt'> </span><span style='font-family: "Courier New"; color: red; font-size: 9pt'>-<span class="SpellE">lt</span></span><span style='font-family: "Courier New"; color: black; font-size: 9pt'> 6) { </span><span style='font-family: "Courier New"; color: blue; font-size: 9pt'>return</span><span style='font-family: "Courier New"; color: black; font-size: 9pt'> }<p></p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: black; font-size: 9pt'><p>&nbsp;</p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: green; font-size: 9pt'># <span class="SpellE">Optionnal</span> - skip network location setting if local machine is joined to a domain.<p></p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: green; font-size: 9pt'>#<span class="GramE">if(</span>1,3,4,5 -contains (Get-<span class="SpellE">WmiObject</span> win32_computersystem).<span class="SpellE">DomainRole</span>) { return }<p></p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: black; font-size: 9pt'><p>&nbsp;</p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: green; font-size: 9pt'># Get network connections<p></p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: purple; font-size: 9pt'>$<span class="SpellE">networkListManager</span></span><span style='font-family: "Courier New"; color: black; font-size: 9pt'> </span><span style='font-family: "Courier New"; color: red; font-size: 9pt'>=</span><span style='font-family: "Courier New"; color: black; font-size: 9pt'> [</span><span style='font-family: "Courier New"; color: teal; font-size: 9pt'>Activator</span><span style='font-family: "Courier New"; color: black; font-size: 9pt'>]:<span class="GramE">:<span style="color: saddlebrown">CreateInstance</span></span>([</span><span style='font-family: "Courier New"; color: teal; font-size: 9pt'>Type</span><span style='font-family: "Courier New"; color: black; font-size: 9pt'>]::</span><span style='font-family: "Courier New"; color: saddlebrown; font-size: 9pt'>GetTypeFromCLSID</span><span style='font-family: "Courier New"; color: black; font-size: 9pt'>([</span><span style='font-family: "Courier New"; color: teal; font-size: 9pt'>Guid</span><span style='font-family: "Courier New"; color: black; font-size: 9pt'>]</span><span style='font-family: "Courier New"; color: maroon; font-size: 9pt'>"{DCB00C01-570F-4A9B-8D69-199FDBA5723B}"</span><span style='font-family: "Courier New"; color: black; font-size: 9pt'>))<p></p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: purple; font-size: 9pt'>$connections</span><span style='font-family: "Courier New"; color: black; font-size: 9pt'> </span><span style='font-family: "Courier New"; color: red; font-size: 9pt'>=</span><span style='font-family: "Courier New"; color: black; font-size: 9pt'> </span><span style='font-family: "Courier New"; color: purple; font-size: 9pt'>$<span class="SpellE"><span class="GramE">networkListManager<span style="color: black">.GetNetworkConnections</span></span></span></span><span class="GramE"><span style='font-family: "Courier New"; color: black; font-size: 9pt'>()</span></span><span style='font-family: "Courier New"; color: black; font-size: 9pt'><p></p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: black; font-size: 9pt'><p>&nbsp;</p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: black; font-size: 9pt'><p>&nbsp;</p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: green; font-size: 9pt'># Set network location to Private for all networks :<p></p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: green; font-size: 9pt'>#$connections | % {$_.<span class="SpellE"><span class="GramE">GetNetwork</span></span><span class="GramE">(</span>).<span class="SpellE">SetCategory</span>(1)}</span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: green; font-size: 9pt'>#Set network location for networks matching the $NetworkNameFilter1 filter :<p></p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: purple; font-size: 9pt'>$connections</span><span style='font-family: "Courier New"; color: black; font-size: 9pt'> | </span><b><span style='font-family: "Courier New"; color: cadetblue; font-size: 9pt'>%</span></b><span style='font-family: "Courier New"; color: black; font-size: 9pt'> </span><b><span style='font-family: "Courier New"; color: cadetblue; font-size: 9pt'>`</span></b><span style='font-family: "Courier New"; color: black; font-size: 9pt'><p></p></span></p>    <blockquote>     <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: black; font-size: 9pt'>{<p></p></span></p>   </blockquote>    <blockquote>     <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: green; font-size: 9pt'>#Change the $NetworkNameFilter1 string variable earlier in the script to identify which network you want to set to public or <span class="GramE">private :</span><p></p></span></p>   </blockquote>    <blockquote>     <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: blue; font-size: 9pt'>If</span><span style='font-family: "Courier New"; color: black; font-size: 9pt'> (</span><span style='font-family: "Courier New"; color: purple; font-size: 9pt'>$_</span><span style='font-family: "Courier New"; color: black; font-size: 9pt'>.<span class="SpellE"><span class="GramE">GetNetwork</span></span><span class="GramE">(</span>).<span class="SpellE">GetName</span>() </span><span style='font-family: "Courier New"; color: red; font-size: 9pt'>-like</span><span style='font-family: "Courier New"; color: black; font-size: 9pt'> </span><span style='font-family: "Courier New"; color: purple; font-size: 9pt'>$NetworkNameFilter1</span><span style='font-family: "Courier New"; color: black; font-size: 9pt'>)</span></p>      <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: black; font-size: 9pt'></span><span style='font-family: "Courier New"; color: black; font-size: 9pt'>{</span></p>      <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: black; font-size: 9pt'></span><b><span style='font-family: "Courier New"; color: cadetblue; font-size: 9pt'>Write-Host</span></b><span style='font-family: "Courier New"; color: black; font-size: 9pt'> </span><span style='font-family: "Courier New"; color: maroon; font-size: 9pt'>"Network category of "</span><span style='font-family: "Courier New"; color: purple; font-size: 9pt'>$_</span><span style='font-family: "Courier New"; color: black; font-size: 9pt'>.<span class="SpellE"><span class="GramE">GetNetwork</span></span><span class="GramE">(</span>).<span class="SpellE">GetName</span>()</span><span style='font-family: "Courier New"; color: maroon; font-size: 9pt'>"was <span class="SpellE">perviously</span> set to "</span><span style='font-family: "Courier New"; color: purple; font-size: 9pt'>$_</span><span style='font-family: "Courier New"; color: black; font-size: 9pt'>.<span class="SpellE">GetNetwork</span>().<span class="SpellE">GetCategory</span>()</span></p>      <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: black; font-size: 9pt'></span><span style='font-family: "Courier New"; color: purple; font-size: 9pt'>$_</span><span style='font-family: "Courier New"; color: black; font-size: 9pt'>.<span class="SpellE">GetNetwork</span>().<span class="SpellE">SetCategory</span>(</span><span style='font-family: "Courier New"; color: purple; font-size: 9pt'>$<span class="SpellE">NetworkTypeAssignment</span></span><span style='font-family: "Courier New"; color: black; font-size: 9pt'>) </span><span style='font-family: "Courier New"; color: green; font-size: 9pt'>#Category "1" is meant for Private Network, and Category "3" is for Public Network<p></p></span></p>   </blockquote>    <blockquote>     <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><b><span style='font-family: "Courier New"; color: cadetblue; font-size: 9pt'>Write-Host</span></b><span style='font-family: "Courier New"; color: black; font-size: 9pt'> </span><span style='font-family: "Courier New"; color: maroon; font-size: 9pt'>"Network category of "</span><span style='font-family: "Courier New"; color: purple; font-size: 9pt'>$_</span><span style='font-family: "Courier New"; color: black; font-size: 9pt'>.<span class="SpellE"><span class="GramE">GetNetwork</span></span><span class="GramE">(</span>).<span class="SpellE">GetName</span>()</span><span style='font-family: "Courier New"; color: maroon; font-size: 9pt'>"network changed to "</span><span style='font-family: "Courier New"; color: purple; font-size: 9pt'>$_</span><span style='font-family: "Courier New"; color: black; font-size: 9pt'>.<span class="SpellE">GetNetwork</span>().<span class="SpellE">GetCategory</span>()<p></p></span></p>   </blockquote>    <blockquote>     <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: black; font-size: 9pt'>}<p></p></span></p>   </blockquote>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: black; font-size: 9pt'><p></p></span></p>    <p style="line-height: normal; margin-bottom: 0pt; text-autospace: ; mso-layout-grid-align: none" class="MsoNormal"><span style='font-family: "Courier New"; color: black; font-size: 9pt'>}<p></p></span></p>    <p class="MsoNormal"><p>&nbsp;</p></p> </div></p>

