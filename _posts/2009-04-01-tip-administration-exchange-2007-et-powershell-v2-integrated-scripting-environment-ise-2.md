---
layout: post
title: TIP - Administration Exchange 2007 et PowerShell V2 Integrated scripting environment (ISE)
date: 2009-04-01 07:05
author: sammykrosoft
comments: true
categories: [EExchange Server 2007, ISE, language, langue, Pages, Powershell, powershell V2, scripting]
---
<P>Il est possible d’installer l’environnement <A href="http://www.microsoft.com/downloads/details.aspx?FamilyID=c913aeab-d7b4-4bb1-a958-ee6d7fe307bc&amp;displaylang=en" target=_blank mce_href="http://www.microsoft.com/downloads/details.aspx?FamilyID=c913aeab-d7b4-4bb1-a958-ee6d7fe307bc&amp;displaylang=en">PowerShell V2 CTP3 (pour Community Technology Preview 3 càd la dernière version “pre-beta”)</A> et l’utiliser pour scripter et administrer votre environnement Exchange 2007. </P>
<P>Cette console facilite grandement la création de scripts (via la coloration synthaxique dans l’éditeur et l’intellisense) et est beaucoup plus fun que la console noire et blanche toute simple de PowerShell V1 :-)</P>
<P><STRONG><U>I- Les prérequis sont</U></STRONG>:</P>
<UL>
<LI>1- Désinstaller la version PowerShell V1 du poste ou du serveur de test&nbsp; (<EM>Hotfix for Windows Server 2003 (KB926139)</EM>) <BR><STRONG><EM>Note :</EM></STRONG> PowerShell V2 est toujours en cours de développement, il est donc déconseillé de l’installer sur un serveur en production. Préférez une station d’administration par exemple, et/ou un serveur de test.) </LI></UL>
<P><FONT size=1><EM>Sur votre station ou votre serveur de test, vous aurez le message suivant : <BR></EM></FONT><A href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/BlogFileStorage/blogs_technet/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_4.png" original-url="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_4.png" mce_href="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_4.png"><FONT color=#000000 size=1><EM><IMG style="BORDER-RIGHT-WIDTH: 0px; DISPLAY: inline; BORDER-TOP-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px" title=image border=0 alt=image src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/BlogFileStorage/blogs_technet/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_thumb_1.png" original-url="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_thumb_1.png" width=244 height=192 mce_src="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_thumb_1.png"></EM></FONT></A><FONT size=1><EM>&nbsp; <BR>cliquez donc sur Yes, les services listés ci-dessus ne seront pas affectés, on retire simplement une console d’administration PowerShell pour la remplacer par une autre… d’où également la recommandation de ne pas installer Powershell V2 sur un serveur de production :)</EM></FONT> </P>
<UL>
<LI>2- Installer le <A href="http://www.microsoft.com/downloads/details.aspx?displaylang=fr&amp;FamilyID=10cc340b-f857-4a14-83f5-25634c3bf043" target=_blank mce_href="http://www.microsoft.com/downloads/details.aspx?displaylang=fr&amp;FamilyID=10cc340b-f857-4a14-83f5-25634c3bf043">.NET FrameWork V3</A> </LI>
<LI>3- Télécharger et installer <A href="http://www.microsoft.com/downloads/details.aspx?FamilyID=c913aeab-d7b4-4bb1-a958-ee6d7fe307bc&amp;displaylang=en" target=_blank mce_href="http://www.microsoft.com/downloads/details.aspx?FamilyID=c913aeab-d7b4-4bb1-a958-ee6d7fe307bc&amp;displaylang=en">PowerShell V2 CTP3 </A></LI></UL>
<P>Lorsque vous lancerez la console d’administration Exchange 2007 PowerShell “non graphique”, vous travaillerez bien avec la version 2 de PowerShell. Pour le vérifier, tapez la ligne <STRONG>$host.version</STRONG></P>
<P>- PowerShell V1 donne : <BR>&nbsp;<A href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/BlogFileStorage/blogs_technet/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_2.png" original-url="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_2.png" mce_href="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_2.png"><IMG style="BORDER-RIGHT-WIDTH: 0px; DISPLAY: inline; BORDER-TOP-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px" title=image border=0 alt=image src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/BlogFileStorage/blogs_technet/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_thumb.png" original-url="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_thumb.png" width=244 height=74 mce_src="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_thumb.png"></A> </P>
<P>- PowerShell V2 donne : <BR><A href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/BlogFileStorage/blogs_technet/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_6.png" original-url="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_6.png" mce_href="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_6.png"><IMG style="BORDER-RIGHT-WIDTH: 0px; DISPLAY: inline; BORDER-TOP-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px" title=image border=0 alt=image src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/BlogFileStorage/blogs_technet/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_thumb_2.png" original-url="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_thumb_2.png" width=244 height=78 mce_src="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_thumb_2.png"></A> </P>
<P>Par contre, dans la version actuelle de PowerShell V2 CTP, on n’aura pas de lien vers la console graphique “ISE” avec les Cmd-lets Exchange.</P>
<P><STRONG><U>II- Voici la procédure d’activation des Cmd-lets Exchange 2007 dans la console graphique ISE:</U></STRONG></P>
<P>Pour administrer Exchange 2007 en utilisant la console graphique ISE , la procédure est simple et consiste à charger les cmd-lets et fonctions PowerShell Exchange comme suit (je ne vais pas expliquer chaque ligne de commande, leur signification se lit dans la commande :-) ):</P>
<P>0- Ouvrez une fenêtre de commande PowerShell ISE :</P>
<P>Menu Démarrer –&gt; Tous les programmes –&gt; Windows PowerShell V2 (CTP3) –&gt; Windows PowerShell ISE (CTP3) <BR><A href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/BlogFileStorage/blogs_technet/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_8.png" original-url="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_8.png" mce_href="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_8.png"><IMG style="BORDER-RIGHT-WIDTH: 0px; DISPLAY: inline; BORDER-TOP-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px" title=image border=0 alt=image src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/BlogFileStorage/blogs_technet/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_thumb_3.png" original-url="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_thumb_3.png" width=549 height=361 mce_src="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_thumb_3.png"></A> </P>
<P>1- Vérifiez que vous avez bien les outils d’administration Exchange 2007 installés sur votre poste ou votre serveur :</P>
<TABLE border=1 cellSpacing=0 cellPadding=2 width=395>
<TBODY>
<TR>
<TD vAlign=top width=21>&gt;_</TD>
<TD vAlign=top width=372><STRONG>Get-PSSnapin –registered </STRONG></TD></TR></TBODY></TABLE>
<P><A href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/BlogFileStorage/blogs_technet/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_10.png" original-url="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_10.png" mce_href="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_10.png"><IMG style="BORDER-RIGHT-WIDTH: 0px; DISPLAY: inline; BORDER-TOP-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px" title=image border=0 alt=image src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/BlogFileStorage/blogs_technet/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_thumb_4.png" original-url="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_thumb_4.png" width=567 height=410 mce_src="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_thumb_4.png"></A> </P>
<P><EM><FONT color=#ff0000>Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Microsoft.Exchange.Management.PowerShell.Admin <BR>PSVersion&nbsp;&nbsp; : 1.0 <BR>Description : Admin Tasks for the Exchange Server</FONT></EM></P>
<P>2- Tapez la commande :</P>
<TABLE border=1 cellSpacing=0 cellPadding=2 width=616>
<TBODY>
<TR>
<TD vAlign=top width=21>&gt;_</TD>
<TD vAlign=top width=593><STRONG>add-pssnapin Microsoft.Exchange.Management.PowerShell.Admin</STRONG></TD></TR></TBODY></TABLE>
<P>&nbsp;<A href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/BlogFileStorage/blogs_technet/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_12.png" original-url="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_12.png" mce_href="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_12.png"><IMG style="BORDER-RIGHT-WIDTH: 0px; DISPLAY: inline; BORDER-TOP-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px" title=image border=0 alt=image src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/BlogFileStorage/blogs_technet/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_thumb_5.png" original-url="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_thumb_5.png" width=575 height=249 mce_src="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_thumb_5.png"></A> <BR><EM><STRONG>Note </STRONG>: la commande ne retourne rien.</EM></P>
<P>3- Vérifiez que votre console ISE a bien chargé les composants d’administration Exchange en tapant la commande :</P>
<TABLE border=1 cellSpacing=0 cellPadding=2 width=230>
<TBODY>
<TR>
<TD vAlign=top width=19>&gt;_</TD>
<TD vAlign=top width=209><STRONG>Get-PSSnapin</STRONG></TD></TR></TBODY></TABLE>
<P>qui doit vous afficher parmi une liste de “Snapins”&nbsp; PowerShell préexistante :</P>
<P><EM><FONT color=#ff0000>Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Microsoft.Exchange.Management.PowerShell.Admin <BR>PSVersion&nbsp;&nbsp; : 1.0 <BR>Description : Admin Tasks for the Exchange Server</FONT></EM></P>
<P><A href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/BlogFileStorage/blogs_technet/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_16.png" original-url="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_16.png" mce_href="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_16.png"><IMG style="BORDER-RIGHT-WIDTH: 0px; DISPLAY: inline; BORDER-TOP-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px" title=image border=0 alt=image src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/BlogFileStorage/blogs_technet/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_thumb_7.png" original-url="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_thumb_7.png" width=583 height=315 mce_src="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_thumb_7.png"></A> </P>
<P>4- Exécutez le script Exchange.ps1 se trouvant dans <EM>Lecteur:\&gt;Program files\Microsoft\Exchange Server\bin\Exchange.ps1</EM></P>
<TABLE border=1 cellSpacing=0 cellPadding=2 width=711>
<TBODY>
<TR>
<TD vAlign=top width=35><STRONG><U>Tip</U> : </STRONG></TD>
<TD vAlign=top width=674>pour utiliser les <STRONG>variables d’environnement</STRONG> dans PowerShell (rappelez-vous, dans l’invite de commande DOS on les appelait entre “%” - %systemroot%, %programfiles%, etc…), utilisez la variable $env:variable (exemple : <STRONG><EM>$env:systemroot</EM></STRONG>, <STRONG><EM>$env:programfiles</EM></STRONG> …), puis tapez la suite du chemin complet vers le script (<STRONG><EM>\Microsoft\Exchange Server\bin\Exchange.ps1</EM></STRONG>), le tout entre guillemets et précédé d’une esperlouette “&amp;” (indique à PowerShell d’exécuter ce qui se trouve entre guillemets, sinon la chaîne de caractères sera bêtement reprise) :</TD></TR></TBODY></TABLE>
<TABLE border=1 cellSpacing=0 cellPadding=2 width=711>
<TBODY>
<TR>
<TD vAlign=top width=19>&gt;_</TD>
<TD vAlign=top width=690><STRONG>&amp; “$env:Programfiles\Microsoft\Exchange Server\bin\Exchange.ps1”</STRONG></TD></TR></TBODY></TABLE>
<P><A href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/BlogFileStorage/blogs_technet/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_18.png" original-url="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_18.png" mce_href="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_18.png"><IMG style="BORDER-RIGHT-WIDTH: 0px; DISPLAY: inline; BORDER-TOP-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px" title=image border=0 alt=image src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/BlogFileStorage/blogs_technet/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_thumb_8.png" original-url="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_thumb_8.png" width=641 height=476 mce_src="http://blogs.technet.com/blogfiles/samdrey/WindowsLiveWriter/tipPowerShellIntegratedscriptingenvironm_10B66/image_thumb_8.png"></A> </P>
<P>(Ce script enregistre quelques fonctions supplémentaires spécifiques à l’administration Exchange Powershell dans l’environnement PowerShell courant, comme <STRONG><EM>get-excommand</EM></STRONG>, <STRONG><EM>quickref</EM></STRONG>, …)</P>
<P>et le tour est joué :-)</P>
<P><STRONG><U>III- Notes de conclusion</U></STRONG></P>
<P><STRONG><EM>Note 1:</EM></STRONG> PowerShell V2 CTP3 n’est qu’en version “CTP”, je déconseille son installation sur un serveur Exchange 2007 de production. Vous pouvez par contre l’installer sur votre station d’administration Exchange 2007, ou sur vos serveurs de test sans soucis.</P>
<P><STRONG><EM>Note 2 :</EM></STRONG> Encore une fois, pour tous les réfractaires au scripting et à la ligne de commande, la nouvelle console ISE, ça change la vie d’un administrateur !</P>
<P>Have fun,</P>
<P>Sam.</P>
