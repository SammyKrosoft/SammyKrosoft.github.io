---
layout: post
title: Exchange 2010, 2013, Office 365â€“Auto Mapping Feature - Audit Full Access Mailbox permissions on your environment before migrating
date: 2015-10-01 19:19
author: sammykrosoft
comments: true
categories: [Uncategorized]
---
<p style="margin-left:36pt;"><span style="font-family:Segoe UI;font-size:12pt;">Hi all, 
</span><p style="margin-left:36pt;">&nbsp; &nbsp;
&nbsp;</p><p style="margin-left:36pt;"><span style="font-family:Segoe UI;font-size:12pt;">long time no see ! 
</span></p><p style="margin-left:36pt;"><span style="font-family:Segoe UI;font-size:12pt;">As these days, many companies are migrating their E-mail infrastructures either to Exchange 2013 or Office 365, we often see the behavior that after being migrated, some users' profiles got automatically loaded with all mailboxes for which these users had full access permissions in Outlook. That could surprise some users and affect Outlook opening's performance as well. 
</span></p><p style="margin-left:36pt;"><a href="https://support.microsoft.com/en-us/kb/2646504"><span style="font-family:Segoe UI;font-size:12pt;">There is an article</span></a><span style="font-family:Segoe UI;font-size:12pt;"> that describes the behavior and the workaround solution, although it says it's for Outlook 2010 and 2007 on Office 365, it's also valid for Outlook 2013, and also for Outlook 2007/2010/2013 on Exchange 2013 private clouds or Exchange 2013 on-premise deployments. As long as the back-end is Exchange 2010 SP1 and later, the <a href="https://technet.microsoft.com/en-us/library/hh529943(v=exchg.141).aspx">auto mapping feature</a> is used by default. 
</span></p><p style="margin-left:36pt;">&nbsp; &nbsp;
&nbsp;</p><p style="margin-left:36pt;"><span style="font-size:12pt;"><span style="font-family:Segoe UI;">To summarize <a href="https://support.microsoft.com/en-us/kb/2646504">the above article</a>, the only solution to work around this is to remove the current "Full Access" rights to these mailboxes, and to re-enable these "full access" rights along with the "AutoMapping" property set to </span><span style="font-family:Courier New;">"$False</span><span style="font-family:Segoe UI;">". But you can do this in bulk by searching all mailboxes with "Full Access" permissions, storing the list of these in a PowerShell variable, then removing the "Full Access" permissions, and then re-adding the "Full Access" permissions along with the </span><span style="font-family:Courier New;">"-Automapping $false</span><span style="font-family:Segoe UI;">" parameter&hellip; 
</span></span></p><p style="margin-left:36pt;">&nbsp; &nbsp;
&nbsp;</p><p style="margin-left:36pt;"><span style="font-family:Segoe UI;font-size:12pt;">Prior to this, you may want to evaluate the amount of mailboxes that have been set with this "Full Access" permissions. To do this, you can use the following Powershell command line which works both on Exchange 2007 and Exchange 2010: 
</span></p><p style="margin-left:36pt;"><span style="font-family:Courier New;">Get-Mailbox -resultsize Unlimited | Get-MailboxPermission | where {$_.user.tostring() -ne "NT AUTHORITY\SELF" -and $_.IsInherited -eq $false -and $_.AccessRights -match "FullAccess" -and ($_.User -notlike 'S-1-5*')} | Select Identity,User,@{Name='AccessRights';Expression={[string]::join(', ', $_.AccessRights)}} | Export-Csv -NoTypeInformation c:\temp\FullMailboxAccessPermissionsReport.csv 
</span></p><p style="margin-left:36pt;"><span style="font-size:12pt;"><span style="font-family:Segoe UI;"><span style="text-decoration:underline;"><strong>NOTE</strong></span>: CAREFUL on huge environments, you may wish to stagger the "</span><span style="font-family:Courier New;">Get-Mailbox &ndash;Resultsize Unlimited</span><span style="font-family:Segoe UI;">" by servers groups for example (</span><span style="font-family:Courier New;">Get-Content servers_list.txt | % {Get-Mailbox &ndash;Resultsize Unlimited &ndash;Server $_}</span><span style="font-family:Segoe UI;">) to avoid waiting hours and using GBs of RAM on your server/management station where you execute the above command from&hellip; for example, querying this on a 155,000 mailboxes environment will make powershell use more than 25GB of RAM and run for up to 24 hours &hellip; so staggering by group of servers is always best. And if possible, don't run any </span><span style="font-family:Courier New;">Get-mailbox &ndash;resultsize Unlimited</span><span style="font-family:Segoe UI;"> directly from a server's shell, but use a dedicated management server/workstation instead to not use the servers RAM uselessly&hellip; 
</span></span></p><p style="margin-left:36pt;"><span style="font-family:Segoe UI;font-size:12pt;">&hellip; so that you can use this format as well: 
</span></p><p style="margin-left:36pt;"><span style="font-family:Courier New;">Get-Mailbox &ndash;Server &lt;Server_name&gt; &ndash;resultSize Unlimited | Get-MailboxPermission | where { ($_.AccessRights -eq "FullAccess") -and ($_.IsInherited -eq $false) -and -not ($_.User -like "NT AUTHORITY\SELF") } | Select Identity,User,@{Name='AccessRights';Expression={[string]::join(', ', $_.AccessRights)}} | Export-Csv -NoTypeInformation c:\temp\FullMailboxAccessPermissionsReport.csv <span style="font-size:14pt;">
			</span></span></p><p style="margin-left:36pt;"><span style="font-family:Segoe UI;"><span style="font-size:12pt;">as shown in <a href="http://exchangepedia.com/2008/02/how-to-list-mailboxes-with-full-mailbox-access-permission-assigned.html" target="_blank">this Exchangepedia.com page</a></span><span style="font-size:22pt;">
			</span><span style="font-size:12pt;">
			</span></span></p><p style="margin-left:36pt;">&nbsp; &nbsp;
&nbsp;</p><p style="margin-left:36pt;"><span style="font-family:Segoe UI;font-size:12pt;">While it is simple to build a report of the mailbox that have "Full access" permissions using Powershell, we don't have Powershell to get such reports for Exchange 2003 environments. There is a VBS script somewhere, but remember, Exchange 2003 is not supported anymore, and this script is not supported either &hellip; so this script is only to help you with pre-migration reporting tasks or for your information. Leave a comment if you still have E2003 and are planning to <a href="http://blogs.technet.com/b/canitpro/archive/2013/05/31/step-by-step-migration-of-exchange-2003-server-to-office-365.aspx" target="_blank">migrate to E2003 or O365</a>&hellip; 
</span></p><p style="margin-left:36pt;">&nbsp; &nbsp;
&nbsp;</p><p style="margin-left:36pt;"><span style="font-family:Segoe UI;font-size:12pt;">Sam. </span></p></p>

