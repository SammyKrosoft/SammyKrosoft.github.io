---
layout: post
title: Exchange Server 2013 – Planning for Public Folders mailboxes according to user logon limits
date: 2015-06-13 20:01
author: sammykrosoft
comments: true
categories: [Uncategorized]
---
<p align="justify">Since there are some <a href="https://technet.microsoft.com/en-us/library/dn594582(v=exchg.150).aspx">limitations for Exchange 2013 Public Folders</a>, we will focus this little note on the <strong>User Logons supported limit, which is 2,000</strong>.</p>  <p align="justify"></p>  <p align="justify">I briefly mentioned this 2,000 user logons limit on the article about <a href="/b/samdrey/archive/2015/03/18/exchange-2013-cu8-some-new-limits-for-modern-public-folders.aspx">Public Folder limits increase since Exchange 2013 CU8 on a previous blog post</a>.</p>  <p align="justify"></p>  <p align="justify">In Exchange 2013, you should plan for a number of PF mailboxes according to:</p>  <ul>   <li align="justify">the volume of PFs you have as the limit is 100GB per PF Mailbox – and 100 PF mailboxes max – reserve 1 for hierarchy updates, that leaves 99 PF mailboxes max for content storage</li>    <li align="justify">a target number of Client Logons you’ll have</li> </ul>  <p align="justify">Knowing that a single user can issue more than 1 client logons at a time because these are accessing the PF Hierarchy + accessing PF content which is hosted on another PF Mailbox + other content on other PF Mailboxes … And, knowing that if a user accesses PF content that is on his “default PF Mailbox”, that counts for 1 concurrent user logon … so that’s not an easy exercise !</p>  <p align="justify"><em>If you wish to know more about the difference between a “session” and a “logon”, read </em><a href="/b/exchange/archive/2006/09/11/3394858.aspx"><em>this blog post from the Exchange product team</em></a><em>.</em></p>  <p align="justify">&#160;</p>  <p align="justify"><a href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/73/61/metablogapi/3058.image_5.png" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-73-61-metablogapi/3058.image_5F00_5.png"><img title="Exchange 2013 user logon behavior for hierarchy and content connections..." style="display:inline;" border="0" alt="Exchange 2013 user logon behavior for hierarchy and content connections..." src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/73/61/metablogapi/1781.image_thumb.png" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-00-73-61-metablogapi/1781.image_5F00_thumb.png" width="859" height="462" /></a></p>  <p align="justify"><em>Note: in Exchange 2013, we cannot spread or duplicate a single folder contents on multiple PF mailboxes – remember in previous Exchange versions, we were able to replicate “active” content on multiple PF Databases – in E2013 we only replicate an active database hosting a PF Mailbox onto a passive database)</em></p>  <p align="justify">&#160;</p>  <p align="justify">The best thing to do to assess the target number of User Logons is to analyze what you currently have on your existing Exchange environment(s).</p>  <p align="justify"><b>- <span style="text-decoration:underline;">On each server that hosts a Public Folder database servicing users connections, collect the following performance counters during 3 to 4 days with a collection interval of 60 seconds</span></b></p>  <p align="justify">Below are the perfmon counters that will enable us to estimate how many user logons we have on public folders database on a server (Exchange 2003, 2007, 2010):</p>  <div align="justify">   <table cellspacing="0" cellpadding="0" border="1"><tbody>       <tr>         <td width="365">           <p><b>Category</b></p>         </td>          <td width="365">           <p><b>CounterPath</b></p>         </td>          <td width="365">           <p><b>Description</b></p>         </td>       </tr>        <tr>         <td width="365">           <p>Microsoft Exchange Public Folder Store performance data</p>         </td>          <td width="365">           <p><span style="text-decoration:underline;"><a>\\MSExchangeIS Public\Client Logons</a></span></p>         </td>          <td width="365">           <p>Client Logons is the number of clients (including system processes) currently logged on.</p>         </td>       </tr>        <tr>         <td width="365">           <p>Microsoft Exchange Public Folder Store performance data</p>         </td>          <td width="365">           <p><span style="text-decoration:underline;"><a>\\MSExchangeIS Public\Active Client Logons</a></span></p>         </td>          <td width="365">           <p>Active Client Logons is the number of clients that performed any action within the last ten minute time interval.</p>         </td>       </tr>        <tr>         <td width="365">           <p>Microsoft Exchange Public Folder Store performance data</p>         </td>          <td width="365">           <p><span style="text-decoration:underline;"><a>\\MSExchangeIS Public\Peak Client Logons</a></span></p>         </td>          <td width="365">           <p>Peak Client Logons is the maximum number of concurrent client logons since the service started.</p>         </td>       </tr>     </tbody></table> </div>  <p align="justify"><em>Note that these numbers take into account all logged on Outlook 2003 users, even these who don’t use PFs to store documents, because Outlook 2003 has to use Public Folders for system related tasks (Free/Busy, Offline Address Book, …).</em></p>  <p align="justify"><em>Note also that even Outlook 2007/2010/2013 will connect to Public Folders by default to check for Organizational Froms, even to publish Free/Busy data, despite the fact these versions use the Availability Service as well. You can use a </em><a href="/b/johnmak/archive/2012/03/26/how-to-stop-outlook-from-using-public-folders.aspx"><em>registry key at the client level</em></a><em> to block PF connections for Outlook 2007/2010/2013 (<strong><span style="text-decoration:underline;">nothing exists on the server level to block PF connections</span></strong>) – since it’s a desktop registry key, you’ll have to deploy it using GPOs – you can&#160; target GPOs to specific security groups.</em></p>  <p align="justify">Ø <strong>ACTION : </strong>Collect perfmon data for at best 1 week (at minimum 3 days) using a 1 minute (60 seconds) sample, and then we’ll take the max in client Logons and Active Client Logons (and Peak Client Logons) and calculate how many E2013 PF Mailboxes we may need to service client logons while staying below the save 2,000 user logons limit.</p>  <p align="justify"></p>  <p align="justify"><strong>IMPORTANT: </strong>as mentioned in the above schema, <strong>additional logons opened for content queries will not stay forever</strong>, which adds some relief and confidence that staying below the 2,000 user logons limit is feasible. Using the above study on existing environments before the migration will also help a lot.. Below is he explanation from our Microsoft Exchange as well as Outlook Product Groups about content logons persistence:</p>  <p align="justify">&#160;</p>  <p align="justify">When an Outlook user opens a Public Folder to see the content, the Public Folder connection (=user logon) will likely live for <strong>around 75 minutes</strong>.</p>  <p align="justify"></p>  <p align="justify">Here are some bullets to explain what’s going on:</p>  <ul>   <li align="justify">&#160; A connection lives [only] as long as an open Object (message/folder) is holding a reference on it.</li>    <li align="justify">&#160; Navigating to a Public Folder creates a <strong>Content Folder Object</strong>, which holds a <strong>reference to the Content Mailbox</strong>.</li>    <li align="justify">&#160; Any <strong>Folder Object</strong>, including this <strong>Content Folder Object</strong>, will be added to what’s called the <strong>Object Cache</strong>.</li>    <li align="justify">&#160; Objects remain in the Object Cache until there is about <strong>75 minutes of inactivity</strong>, at which time the Object will be <strong>released from the Object Cache</strong>. Before the time is up if the user navigates back to the folder the clock will restart.</li>    <li align="justify">&#160; Once the ~75 minutes of inactivity passes the <strong>Content Folder Object is released</strong> from the Object Cache. When it is released it will release its reference on the Connection to the Content Mailbox.</li>    <li align="justify">&#160; Having no more references holding it open, <strong>the</strong> <strong>Connection goes away</strong>.</li> </ul>  <p align="justify">&#160;</p>  <p align="justify"><strong>Once again, thanks very much to the Exchange and Outlook Product Groups for clarifying this.</strong></p>  <p align="justify">Sam.</p>
