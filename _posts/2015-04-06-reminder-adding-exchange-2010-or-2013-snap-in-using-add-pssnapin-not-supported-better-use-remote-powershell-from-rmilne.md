---
layout: post
title: Reminder – Adding Exchange 2010 or 2013 snap-in using Add-PSSnapin not supported – Better use Remote Powershell (From RMilne)
date: 2015-04-06 19:45
author: sammykrosoft
comments: true
categories: [Uncategorized]
---
<p align="justify"><font face="Segoe UI">&nbsp;</font><font face="Segoe UI"></font><p align="justify"><font face="Segoe UI">As a bookmark, my buddy </font><a ="http://blogs.technet.com"><font face="Segoe UI">Rhoderick Milne</font></a><strong></strong><font face="Segoe UI"> has written an excellent article about the best way to invoke Exchange PowerShell environment (other than loading the &ldquo;Exchange Management Shell&rdquo; itself from the Windows menus &ndash; for example, if you want to use a Windows Powershell session you&rsquo;re currently in, or simply the Powershell Integrated Scripting Environment (ISE)) is to use Remote Powershell.</font></p><font face="Segoe UI"></font><p align="justify"><font face="Segoe UI">The use of &ldquo;<font size="2" face="lucida console">Add-PSsnapin Microsoft.Exchange.Management.PowerShell.E2010</font><em>&rdquo;</em> is <strong><u>not</u> </strong>supported.</font></p><font face="Segoe UI"></font><p align="justify"><font face="Segoe UI">The following instead, using Remote PowerShell, is supported:</font></p><p align="justify"><font face="Segoe UI"></font></p><font face="Segoe UI"></font><p align="left"><font size="2" face="Lucida console">$Session = New-PSSession -ConfigurationName Microsoft.Exchange -ConnectionUri </font><a href="http://%3cserverfqdn/"><font size="2" face="Lucida console">http://&lt;ServerFQDN</font></a><font size="2" face="Lucida console">&gt;/PowerShell/ -Authentication Kerberos</font></p><p align="justify"><font size="2" face="Lucida console"></font></p><font size="2" face="Lucida console"></font><p align="justify"><font size="2" face="Lucida console">Import-PSSession $Session</font></p><font face="Segoe UI"></font><p align="justify">&nbsp;</p><p align="justify"><font face="Segoe UI">&hellip; and to disconnect the session:</font></p><font face="Segoe UI"></font><ul>   <li>     <div align="justify"><font face="Segoe UI">either close your powershell window </font></div>   </li>    <li>     <div align="justify"><font face="Segoe UI">or to stay in your current session, use </font><font size="2" face="Lucida console">Remove-PSSession $Session</font></div>   </li> </ul><font face="Segoe UI"></font><p align="justify"><font face="Segoe UI">&nbsp;</font></p><p align="justify"><font face="Segoe UI">Note1: the above example is using http (port 80, not encrypted), but the session being secured as we used the &ndash;Authentication Kerberos method.</font></p><p align="justify"><font face="Segoe UI">For a remote forest connection, you must use HTTPS, and for that, you need to enable &ldquo;Windows Authentication&rdquo; on your Poweshell vdirs (on E2013, do this for both &ldquo;Default Web SitePowershell&rdquo; and &ldquo;Exchange Back EndPowerShell&rdquo; vdirs) </font></p><p align="left"><font size="2" face="Lucida console">$Session = New-PSSession -ConfigurationName Microsoft.Exchange -ConnectionUri </font><a href="https://&lt;ServerFQDN"><font size="2" face="Lucida console">https://&lt;ServerFQDN</font></a><font size="2" face="Lucida console">&gt;/PowerShell/ &ndash;Credentials (Get-Credentials)</font></p><p align="justify"><font face="Segoe UI"></font>&nbsp;</p><p align="justify"><font face="Segoe UI">For a lab environment for which you don&rsquo;t have trusted certs, you may have certificate check errors, you can specify to ignore the cert checks using the PSSessionOptions:</font></p><p><font size="2">$<font face="Courier new">PSOptions = New-PSSessionOption &ndash;SkipCACheck &ndash;SkipRevocationCheck -SkipCNCheck</font></font></p><p>then same as above but adding the <font face="Courier New">&ndash;<font size="2">SessionOptions</font></font> parameter:</p><p align="left"><font size="2" face="Lucida Console">$Session = New-PSSession -ConfigurationName Microsoft.Exchange -ConnectionUri </font><a href="https://%3cserverfqdn/"><font size="2" face="Lucida Console">https://&lt;ServerFQDN</font></a><font size="2" face="Lucida Console">&gt;/PowerShell/ &ndash;Credentials (Get-Credentials) &ndash;SessionOption $PSOptions</font></p><p align="justify"><font size="2" face="Lucida Console"></font></p><font face="Segoe UI"></font><p align="justify"><font face="Segoe UI">All detailed information are on </font><a href="http://blogs.technet.com/b/rmilne/archive/2015/01/28/directly-loading-exchange-2010-or-2013-snapin-is-not-supported.aspx"><font face="Segoe UI">Rhoderick&rsquo;s blog post about Directly Loading Exchange 2010 or 2013 SnapIn Is Not Supported</font></a><font face="Segoe UI">, this post is a bookmark and a refresher.</font></p></p> 
