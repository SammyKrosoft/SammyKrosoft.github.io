---
layout: post
title: How To - Use a PowerBI template to analyze Event Logs exported as a CSV file
date: 2018-05-04 20:08
author: sammykrosoft
comments: true
categories: [Exchange, PowerBI, powershell]
---
<h1>Prerequisites/Ingredients</h1>
<ul>
 	<li><strong>PowerBI Desktop</strong> – You can <a target="_blank" href="https://powerbi.microsoft.com/en-us/desktop/" rel="noopener">download it here</a></li>
 	<li>The<strong> PowerBI Event Log analysis template</strong> - You can <a target="_blank" href="https://msdnshared.blob.core.windows.net/media/2018/05/Event_Dump_Analysis_Template.zip" rel="noopener">download it here</a> - it is a .PBIT format, you'll have to unzip it.</li>
 	<li><strong>Windows Powershell</strong> (from 2.0 – Windows 2008/2008R2 up to 5.2- Windows 2016)
<strong>or Powershell 6</strong> (<a target="_blank" href="https://github.com/PowerShell/PowerShell/releases" rel="noopener">https://github.com/PowerShell/PowerShell/releases</a>)</li>
 	<li>The <strong>Get-EventsFromEventLogs.ps1 PowerShell script</strong> – You can <a target="_blank" href="https://gallery.technet.microsoft.com/View-or-Export-To-CSV-62ebd49c" rel="noopener">download it here</a></li>
</ul>
Before loading the PowerBI template I made for you, you must have a CSV collected with the Get-EventsFromEventLogs.ps1 script. See the following sections…
<h1>Collect your events using the Get-EventsFromEventLogs script</h1>
Collect the events from your servers using the <a href="https://gallery.technet.microsoft.com/View-or-Export-To-CSV-62ebd49c">Get-EventsFromEventLogs.ps1 script</a>, preferably using the following parameters – just replace the <strong>Server01, Server02</strong> with <strong>your computers</strong>, or the content of a <strong>Computers.txt</strong> file:
<pre><span style="font-family: Courier New"><strong><span style="color: #333333"><span style="background-color: whitesmoke">.\Get-EventsFromEventLogs.ps1 -Computers Server01,Server02 -EventLevel Warning,Error,Critical -NumberOfLastEventsToGet 200 <span style="background-color: whitesmoke">–ExportToFile</span></span></span></strong></span></pre>
Note: to get the computers list from a text file use the following syntax just after the -Computers parameter :
<pre><span style="font-family: Courier New"><strong>-Computers $(Get-Content C:\temp\Computers.txt)</strong></span></pre>
The exported CSV file will be located on the same directory where you placed your <span style="font-family: Courier New"><strong>Get-EventsFromEventLogs.ps1</strong></span> script, and will be named like <strong>"<span style="font-family: Courier New">GetEventsFromEventLogs_blabla-Date-Time.csv</span></strong>"
<h1>Get the PowerBI template</h1>
The template created to work with the file exported with the Get-EventsFromEventLogs.ps1 script is named :
<pre><span style="font-family: Courier New;font-size: 12pt"><strong> Event_Dump_Analysis_Template.pbit</strong></span></pre>
See the prerequisites above for the download link - I'm placing <a target="_blank" href="https://msdnshared.blob.core.windows.net/media/2018/05/Event_Dump_Analysis_Template.zip" rel="noopener">here </a>for convenience in case you forgot to go through the prerequisites.
<h1>Open the PowerBI Template (PBIT) and point it to your CSV Events file</h1>
<strong>NOTE</strong>: you will need the CSV file that was generated by the <span style="font-family: Courier New"><strong>Get-EventsFromEventLogs.ps1</strong></span> script introduced on section 2 above…

Open it -&gt; <strong>you will have an error</strong> just after PowerBI Desktop loaded =&gt; it is expected because we didn't specify the <strong>GetEventsFromEventLogs-xxxx-xxxx-xxx.CSV</strong> file to analyze yet ! It's coming on next step.

<img alt="" src="https://msdnshared.blob.core.windows.net/media/2018/05/050518_0112_HOWTOUsePow1.png" />

Here's the <strong>expected error</strong> you'll get because at this point we didn't load our correct CSV file (<em>I had to put a dummy value on the "URI" field to create the template because PowerBI doesn't have the functionality to request a CSV file prior to load the template for now</em>):

<img alt="" src="https://msdnshared.blob.core.windows.net/media/2018/05/050518_0112_HOWTOUsePow2.png" />

Click "<strong>Close</strong>" -&gt; you'll see the first page of the report with blank values (because you didn't load your CSV yet !):

<img alt="" src="https://msdnshared.blob.core.windows.net/media/2018/05/050518_0112_HOWTOUsePow3.png" />

Click on "<strong>Edit Queries</strong>" button – I'm highlighting the button below so that you can't miss it :

<img alt="" src="https://msdnshared.blob.core.windows.net/media/2018/05/050518_0112_HOWTOUsePow4.png" />

This will open the "<strong>Power Query Editor</strong>" window:

<img alt="" src="https://msdnshared.blob.core.windows.net/media/2018/05/050518_0112_HOWTOUsePow5.png" />

See the "<strong>APPLIED STEPS</strong>" on the far right of the screen above? Here's a closeup of it:

<img alt="" src="https://msdnshared.blob.core.windows.net/media/2018/05/050518_0112_HOWTOUsePow6.png" />

And a bit closer:

<img alt="" src="https://msdnshared.blob.core.windows.net/media/2018/05/050518_0112_HOWTOUsePow7.png" />

There is an entry in the list called "<strong>Source</strong>" with a configuration gear beneath it

<img alt="" src="https://msdnshared.blob.core.windows.net/media/2018/05/050518_0112_HOWTOUsePow8.png" />-&gt; click on the configuration gear of the "<strong>Source</strong>" entry, which will lead you there:

<img alt="" src="https://msdnshared.blob.core.windows.net/media/2018/05/050518_0112_HOWTOUsePow9.png" />

Closeup of the field we'll need to change:

<img alt="" src="https://msdnshared.blob.core.windows.net/media/2018/05/050518_0112_HOWTOUsePow10.png" />

See the value you see in "<strong>URL</strong>" (default is <span style="font-family: Courier New;font-size: 12pt">.\GetEventsFromEventLog.csv</span>, which is purposely invalid) =&gt; Change it to the path to the CSV file generated by your <span style="font-family: Courier New;font-size: 12pt">Get-ExchangeFromEventLogs.ps1</span> script – here I'll take my CSV file located in my <span style="font-family: Courier New">C:\TEMP\</span> directory, and which I renamed MyEvents.CSV – I'll then specify in the "URL" field "<span style="font-family: Courier New;font-size: 12pt">C:\TEMP\MyEvents.CSV</span>" – This is an example, just put your actual full CSV path and file name :

<img alt="" src="https://msdnshared.blob.core.windows.net/media/2018/05/050518_0112_HOWTOUsePow11.png" />

Click "<strong>OK</strong>" -&gt; you should see the first elements of your CSV on the "Power Query Editor" window:

<img alt="" src="https://msdnshared.blob.core.windows.net/media/2018/05/050518_0112_HOWTOUsePow12.png" />

And click on the "<strong>Close and Apply</strong>" button on the upper left corner of the "<strong>Home</strong>" ribbon menu:

<img alt="" src="https://msdnshared.blob.core.windows.net/media/2018/05/050518_0112_HOWTOUsePow13.png" />

And Magic Happens ! Your PowerBI report will be filled with the stats from your collected CSV !

<img alt="" src="https://msdnshared.blob.core.windows.net/media/2018/05/050518_0112_HOWTOUsePow14.png" />

Navigate to the other tabs to see your events stats, click on the bars and/or on the servers to see the information filtered dynamically.
<pre>-------------------------- EXAMPLE 1 --------------------------</pre>
The "Errors only for each server" tab:

<img alt="" src="https://msdnshared.blob.core.windows.net/media/2018/05/050518_0112_HOWTOUsePow15.png" />

Click on the first bar (you'll see 1 bar per server – if you have 40 servers, you'll see 40 bars showing the number of Event Logs errors per server), and see the below table filtering dynamically to the error events that belong to that server only :

<img alt="" src="https://msdnshared.blob.core.windows.net/media/2018/05/050518_0112_HOWTOUsePow16.png" />

Same principle if you click an event in the below table, for example the first line that has 356 errors for my MSExchangeRepl service, it will show on which server these are distributed :

<img alt="" src="https://msdnshared.blob.core.windows.net/media/2018/05/050518_0112_HOWTOUsePow17.png" />
<pre>-------------------------- EXAMPLE 2 --------------------------</pre>
Let's see the "Errors/Warnings per provider name" tab :

<img alt="" src="https://msdnshared.blob.core.windows.net/media/2018/05/050518_0112_HOWTOUsePow18.png" />

Here I have all the Errors and Warnings filtered in this page, shown by "Event Source" aka "Provider Name" (I should have renamed it). Same here, you can click either on one event on the below table to see the distribution per server or like the example below, on one of the category for which you'd like to see the errors and which server has this event – below I clicked on "<em>Service control manager</em>"

<img alt="" src="https://msdnshared.blob.core.windows.net/media/2018/05/050518_0112_HOWTOUsePow19.png" />
<pre>-------------------------- EXAMPLE 3 --------------------------</pre>
Finally, you can dig a bit more and check for the details of event logs with the last tab "<strong>Fine analysis – All events</strong>" – you can select a "<strong>ProviderName</strong>" aka "<strong>Event Source</strong>", or a server (one of the two bars below), or an event, and see what it does – below is the table before clicking on a "ProviderName":

<img alt="" src="https://msdnshared.blob.core.windows.net/media/2018/05/050518_0112_HOWTOUsePow20.png" />

And below the table after clicking on the "ESE" Provider Name aka Event Source:

<img alt="" src="https://msdnshared.blob.core.windows.net/media/2018/05/050518_0112_HOWTOUsePow21.png" />

You see I have this event on only 1 of my servers (1 bar show up when I click on "ESE") …

Have fun !

Cheers

Sam
